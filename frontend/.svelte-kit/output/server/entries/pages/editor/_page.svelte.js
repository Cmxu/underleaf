import{i as P,e as a,j as w,k as D,l as g,c as b,p,m as C,f as v,h as S}from"../../../chunks/index.js";import"../../../chunks/client.js";import{j as d}from"../../../chunks/equality.js";const T="http://localhost:3001";class y{baseUrl;constructor(s=T){this.baseUrl=s}async request(s,t={}){const i=`${this.baseUrl}${s}`,r=await fetch(i,{headers:{"Content-Type":"application/json",...t.headers},...t});if(!r.ok){const n=await r.json().catch(()=>({error:"Unknown error"}));throw new Error(n.error||`Request failed with status ${r.status}`)}return r.json()}async cloneRepo(s,t="anonymous"){return this.request("/api/clone",{method:"POST",body:JSON.stringify({repoUrl:s,userId:t})})}async compileRepo(s,t="anonymous",i="main.tex"){return this.request("/api/compile",{method:"POST",body:JSON.stringify({repoName:s,userId:t,texFile:i})})}async getFileTree(s,t="anonymous"){return this.request(`/api/files/${t}/${s}`)}async getFileContent(s,t,i="anonymous"){const r=new URLSearchParams({filePath:t});return this.request(`/api/files/${i}/${s}/content?${r}`)}async saveFile(s,t,i,r="anonymous"){return this.request(`/api/files/${r}/${s}/content`,{method:"PUT",body:JSON.stringify({filePath:t,content:i})})}}const U=new y;function k(e,s){p();let t=s.item,i=d(s.depth,0),r=s.expandedDirs,n=s.selectedFile,c=s.onToggleDirectory,u=s.onSelectFile;function f(o){if(o.type==="directory")return r.has(o.path)?"ğŸ“‚":"ğŸ“";switch(o.name.split(".").pop()?.toLowerCase()){case"tex":return"ğŸ“„";case"pdf":return"ğŸ“‹";case"png":case"jpg":case"jpeg":case"gif":return"ğŸ–¼ï¸";case"md":return"ğŸ“";case"json":return"âš™ï¸";case"bib":return"ğŸ“š";default:return"ğŸ“„"}}function h(o){return o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(1)} KB`:`${(o/(1024*1024)).toFixed(1)} MB`}if(e.out+=`<div class="select-none"${P(`margin-left: ${C(i*16)}px`)}>`,t.type==="directory"){if(e.out+="<!--[-->",e.out+=`<button class="w-full text-left px-4 py-1 hover:bg-gray-700 transition-colors flex items-center text-sm text-gray-300"><span class="w-4 text-xs">${a(f(t))}</span> <span class="ml-2 truncate">${a(t.name)}</span></button> `,r.has(t.path)&&t.children){e.out+="<!--[-->";const o=w(t.children);e.out+="<!--[-->";for(let x=0,l=o.length;x<l;x++){let m=o[x];k(e,{item:m,depth:i+1,expandedDirs:r,selectedFile:n,onToggleDirectory:c,onSelectFile:u}),e.out+="<!---->"}e.out+="<!--]-->"}else e.out+="<!--[!-->";e.out+="<!--]-->"}else e.out+="<!--[!-->",e.out+=`<button${D("w-full text-left px-4 py-1 hover:bg-gray-700 transition-colors flex items-center justify-between text-sm group",void 0,{"bg-blue-600":n===t.path,"text-white":n===t.path,"text-gray-300":n!==t.path})}><div class="flex items-center min-w-0"><span class="w-4 text-xs">${a(f(t))}</span> <span class="ml-2 truncate">${a(t.name)}</span></div> `,t.size!==void 0?(e.out+="<!--[-->",e.out+=`<span class="text-xs text-gray-500 group-hover:text-gray-400 ml-2 flex-shrink-0">${a(h(t.size))}</span>`):e.out+="<!--[!-->",e.out+="<!--]--></button>";e.out+="<!--]--></div>",g(s,{item:t,depth:i,expandedDirs:r,selectedFile:n,onToggleDirectory:c,onSelectFile:u}),b()}function L(e,s){p();let t=d(s.repoName,null),i=d(s.onFileSelect,()=>{}),r=[],n=new Set,c=null,u=!1,f=null;async function h(){if(t){u=!0,f=null;try{r=(await U.getFileTree(t)).tree}catch(l){f=l instanceof Error?l.message:"Failed to load file tree"}finally{u=!1}}}function o(l){n.has(l)?n.delete(l):n.add(l),n=new Set(n)}function x(l){c=l,i(l)}if(t&&h(),e.out+='<div class="h-full flex flex-col bg-dark-800"><div class="p-4 border-b border-gray-700"><h3 class="text-gray-300 font-medium flex items-center"><span class="mr-2">ğŸ“</span> File Explorer</h3> ',t?(e.out+="<!--[-->",e.out+=`<p class="text-xs text-gray-400 mt-1 truncate">${a(t)}</p>`):e.out+="<!--[!-->",e.out+='<!--]--></div> <div class="flex-1 overflow-y-auto">',u)e.out+="<!--[-->",e.out+='<div class="p-4 text-center"><div class="loading-spinner mx-auto mb-2"></div> <p class="text-gray-400 text-sm">Loading files...</p></div>';else if(f)e.out+="<!--[1-->",e.out+=`<div class="p-4 text-center"><p class="text-red-400 text-sm mb-2">âš ï¸ Error loading files</p> <p class="text-gray-400 text-xs">${a(f)}</p> <button class="mt-2 text-blue-400 hover:text-blue-300 text-sm underline">Retry</button></div>`;else if(!t)e.out+="<!--[2-->",e.out+='<div class="p-4 text-center text-gray-400 text-sm"><p>ğŸ“‚</p> <p class="mt-2">No repository loaded</p></div>';else if(r.length===0)e.out+="<!--[3-->",e.out+='<div class="p-4 text-center text-gray-400 text-sm"><p>ğŸ“­</p> <p class="mt-2">Repository is empty</p></div>';else{e.out+="<!--[!-->";const l=w(r);e.out+="<!--[-->";for(let m=0,F=l.length;m<F;m++){let j=l[m];k(e,{item:j,depth:0,expandedDirs:n,selectedFile:c,onToggleDirectory:o,onSelectFile:x})}e.out+="<!--]-->"}e.out+="<!--]--></div></div>",g(s,{repoName:t,onFileSelect:i}),b()}function R(e,s){let t=d(s.pdfUrl,null),i=d(s.isLoading,!1),r=d(s.error,null);function n(c){return`/pdfjs/web/viewer.html?file=${encodeURIComponent(c)}`}e.out+='<div class="h-full flex flex-col bg-gray-100"><div class="flex-1 relative">',i?(e.out+="<!--[-->",e.out+='<div class="absolute inset-0 flex items-center justify-center bg-gray-50"><div class="text-center"><div class="loading-spinner mx-auto mb-4 w-8 h-8"></div> <p class="text-gray-600">Compiling PDF...</p></div></div>'):r?(e.out+="<!--[1-->",e.out+=`<div class="absolute inset-0 flex items-center justify-center bg-red-50"><div class="text-center max-w-md mx-auto p-6"><svg class="w-16 h-16 mx-auto mb-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg> <h3 class="text-lg font-medium text-red-800 mb-2">Compilation Error</h3> <p class="text-red-600 text-sm mb-4">${a(r)}</p> <p class="text-xs text-gray-500">Install LaTeX (TeX Live) or Docker for full compilation support.</p></div></div>`):t?(e.out+="<!--[!-->",e.out+=`<iframe${v("src",n(t))} class="w-full h-full border-0" title="PDF Preview"></iframe>`):(e.out+="<!--[2-->",e.out+='<div class="absolute inset-0 flex items-center justify-center"><div class="text-center text-gray-600"><svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <p class="text-lg font-medium mb-2">PDF Preview</p> <p class="text-sm">Compile your LaTeX document to see the preview</p></div></div>'),e.out+="<!--]--></div> ",t&&!i&&!r?(e.out+="<!--[-->",e.out+=`<div class="bg-gray-200 px-4 py-2 border-t border-gray-300 flex items-center justify-between text-sm"><span class="text-gray-600">PDF Preview</span> <div class="flex items-center space-x-2"><button class="text-gray-600 hover:text-gray-800 transition-colors" title="Refresh PDF" aria-label="Refresh PDF"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button> <a${v("href",n(t))} target="_blank" rel="noopener noreferrer" class="text-gray-600 hover:text-gray-800 transition-colors" title="Open in new tab" aria-label="Open PDF in new tab"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a></div></div>`):e.out+="<!--[!-->",e.out+="<!--]--></div>",g(s,{pdfUrl:t,isLoading:i,error:r})}function E(e,s){p();let t=!1,i=null,r=null,n=null;async function c(u){}S(e,u=>{u.title="<title>Editor - Underleaf</title>"}),e.out+='<div class="h-screen flex flex-col bg-dark-900"><header class="bg-dark-800 border-b border-gray-700 px-6 py-4 flex items-center justify-between"><div class="flex items-center space-x-4"><button class="text-gray-300 hover:text-white transition-colors" aria-label="Go back to home"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button> <div><h1 class="text-xl font-semibold text-white">Underleaf Editor</h1> ',e.out+="<!--[!-->",e.out+='<!--]--></div></div> <div class="flex items-center space-x-4">',e.out+="<!--[!-->",e.out+="<!--]--> ",e.out+="<!--[!-->",e.out+="<!--]--> ",e.out+="<!--[!-->",e.out+=`<!--]--> <button${v("disabled",!r,!0)} class="btn-primary px-6 py-2 text-sm disabled:opacity-50">`,e.out+="<!--[!-->",e.out+="Compile PDF",e.out+='<!--]--></button></div></header> <div class="flex-1 flex overflow-hidden"><aside class="w-64 bg-dark-800 border-r border-gray-700 overflow-y-auto">',L(e,{repoName:r,onFileSelect:c}),e.out+='<!----></aside> <div class="flex-1 flex flex-col">',e.out+="<!--[!-->",e.out+='<!--]--> <div class="flex-1 relative"><div class="w-full h-full"></div></div> ',e.out+="<!--[!-->",e.out+='<!--]--></div> <aside class="w-1/2 border-l border-gray-700">',R(e,{pdfUrl:n,isLoading:t,error:i}),e.out+="<!----></aside></div></div>",b()}export{E as default};
//# sourceMappingURL=_page.svelte.js.map
