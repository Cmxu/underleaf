{"version":3,"file":"_page.svelte.js","sources":["../../../../../../src/lib/utils/api.ts","../../../../../../src/lib/components/FileTreeNode.svelte","../../../../../../src/lib/components/FileTree.svelte","../../../../../../src/lib/components/PdfPreview.svelte","../../../../../../src/lib/components/ClaudeCodeModal.svelte","../../../../../../src/routes/editor/+page.svelte"],"sourcesContent":["import { browser } from '$app/environment';\nimport type {\n\tCloneRepoRequest,\n\tCloneRepoResponse,\n\tCompileRepoRequest,\n\tCompileRepoResponse,\n\tFileTreeResponse,\n\tFileContentResponse,\n\tSaveFileRequest,\n\tSaveFileResponse,\n\tCreateFileRequest,\n\tCreateFileResponse,\n\tCreateFolderResponse,\n\tDeleteFileResponse,\n\tRenameFileResponse,\n\tGitCommitResponse,\n\tGitPushResponse,\n\tGitStatusResponse,\n\tGitFetchResponse,\n\tGitPullResponse,\n\tClaudeAiRequest,\n\tClaudeAiResponse\n} from '$types/api';\n\nconst API_URL = browser ? import.meta.env.VITE_API_URL || 'http://localhost:3001' : 'http://localhost:3001';\n\nclass ApiClient {\n\tprivate baseUrl: string;\n\n\tconstructor(baseUrl: string = API_URL) {\n\t\tthis.baseUrl = baseUrl;\n\t}\n\n\tprivate async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n\t\tconst url = `${this.baseUrl}${endpoint}`;\n\n\t\tconst response = await fetch(url, {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t...options.headers\n\t\t\t},\n\t\t\t...options\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tconst errorData = await response.json().catch(() => ({ error: 'Unknown error' }));\n\t\t\tthrow new Error(errorData.error || `Request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t}\n\n\tasync cloneRepo(repoUrl: string, userId = 'anonymous', credentials?: { username: string; password: string }): Promise<CloneRepoResponse> {\n\t\treturn this.request<CloneRepoResponse>('/api/clone', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ repoUrl, userId, credentials })\n\t\t});\n\t}\n\n\tasync compileRepo(\n\t\trepoName: string,\n\t\tuserId = 'anonymous',\n\t\ttexFile = 'main.tex'\n\t): Promise<CompileRepoResponse> {\n\t\treturn this.request<CompileRepoResponse>('/api/compile', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ repoName, userId, texFile })\n\t\t});\n\t}\n\n\tasync getFileTree(repoName: string, userId = 'anonymous'): Promise<FileTreeResponse> {\n\t\treturn this.request<FileTreeResponse>(`/api/files/${userId}/${repoName}`);\n\t}\n\n\tasync checkRepoExists(repoName: string, userId = 'anonymous'): Promise<boolean> {\n\t\ttry {\n\t\t\tawait this.getFileTree(repoName, userId);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tasync getFileContent(\n\t\trepoName: string,\n\t\tfilePath: string,\n\t\tuserId = 'anonymous'\n\t): Promise<FileContentResponse> {\n\t\tconst params = new URLSearchParams({ filePath });\n\t\treturn this.request<FileContentResponse>(`/api/files/${userId}/${repoName}/content?${params}`);\n\t}\n\n\tasync saveFile(\n\t\trepoName: string,\n\t\tfilePath: string,\n\t\tcontent: string,\n\t\tuserId = 'anonymous'\n\t): Promise<SaveFileResponse> {\n\t\treturn this.request<SaveFileResponse>(`/api/files/${userId}/${repoName}/content`, {\n\t\t\tmethod: 'PUT',\n\t\t\tbody: JSON.stringify({ filePath, content })\n\t\t});\n\t}\n\n\tasync getGitStatus(repoName: string, userId = 'anonymous'): Promise<GitStatusResponse> {\n\t\treturn this.request<GitStatusResponse>(`/api/git/${userId}/${repoName}/status`);\n\t}\n\n\tasync commitChanges(\n\t\trepoName: string,\n\t\tmessage: string,\n\t\tuserId = 'anonymous',\n\t\tauthor?: { name: string; email: string }\n\t): Promise<GitCommitResponse> {\n\t\treturn this.request<GitCommitResponse>(`/api/git/${userId}/${repoName}/commit`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ message, author })\n\t\t});\n\t}\n\n\tasync pushChanges(\n\t\trepoName: string,\n\t\tuserId = 'anonymous',\n\t\tremote = 'origin',\n\t\tbranch?: string\n\t): Promise<GitPushResponse> {\n\t\tconst body: { remote: string; branch?: string } = { remote };\n\t\tif (branch) {\n\t\t\tbody.branch = branch;\n\t\t}\n\t\treturn this.request<GitPushResponse>(`/api/git/${userId}/${repoName}/push`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify(body)\n\t\t});\n\t}\n\n\tasync fetchChanges(\n\t\trepoName: string,\n\t\tuserId = 'anonymous',\n\t\tremote = 'origin'\n\t): Promise<GitFetchResponse> {\n\t\treturn this.request<GitFetchResponse>(`/api/git/${userId}/${repoName}/fetch`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ remote })\n\t\t});\n\t}\n\n\tasync pullChanges(\n\t\trepoName: string,\n\t\tuserId = 'anonymous',\n\t\tremote = 'origin',\n\t\tbranch?: string\n\t): Promise<GitPullResponse> {\n\t\tconst body: { remote: string; branch?: string } = { remote };\n\t\tif (branch) {\n\t\t\tbody.branch = branch;\n\t\t}\n\t\treturn this.request<GitPullResponse>(`/api/git/${userId}/${repoName}/pull`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify(body)\n\t\t});\n\t}\n\n\tasync createFile(\n\t\trepoName: string,\n\t\tfilePath: string,\n\t\tcontent = '',\n\t\tuserId = 'anonymous'\n\t): Promise<CreateFileResponse> {\n\t\treturn this.request<CreateFileResponse>(`/api/files/${userId}/${repoName}/create-file`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ filePath, content })\n\t\t});\n\t}\n\n\tasync createFolder(\n\t\trepoName: string,\n\t\tfolderPath: string,\n\t\tuserId = 'anonymous'\n\t): Promise<CreateFolderResponse> {\n\t\treturn this.request<CreateFolderResponse>(`/api/files/${userId}/${repoName}/create-folder`, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ folderPath })\n\t\t});\n\t}\n\n\tasync deleteFile(\n\t\trepoName: string,\n\t\tfilePath: string,\n\t\tuserId = 'anonymous'\n\t): Promise<DeleteFileResponse> {\n\t\treturn this.request<DeleteFileResponse>(`/api/files/${userId}/${repoName}/delete`, {\n\t\t\tmethod: 'DELETE',\n\t\t\tbody: JSON.stringify({ filePath })\n\t\t});\n\t}\n\n\tasync renameFile(\n\t\trepoName: string,\n\t\toldPath: string,\n\t\tnewPath: string,\n\t\tuserId = 'anonymous'\n\t): Promise<RenameFileResponse> {\n\t\treturn this.request<RenameFileResponse>(`/api/files/${userId}/${repoName}/rename`, {\n\t\t\tmethod: 'PUT',\n\t\t\tbody: JSON.stringify({ oldPath, newPath })\n\t\t});\n\t}\n\n\tasync sendClaudeMessage(\n\t\trepoName: string,\n\t\tmessage: string,\n\t\tuserId = 'anonymous'\n\t): Promise<ClaudeAiResponse> {\n\t\treturn this.request<ClaudeAiResponse>('/api/claude', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ repoName, message, userId })\n\t\t});\n\t}\n\n\tasync sendClaudeMessageStreaming(\n\t\trepoName: string,\n\t\tmessage: string,\n\t\tonChunk: (chunk: string) => void,\n\t\tuserId = 'anonymous'\n\t): Promise<void> {\n\t\tconst response = await fetch(`${this.baseUrl}/api/claude`, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tbody: JSON.stringify({ repoName, message, userId })\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tconst error = await response.json();\n\t\t\tthrow new Error(error.error || 'Failed to send message');\n\t\t}\n\n\t\tif (!response.body) {\n\t\t\tthrow new Error('No response body');\n\t\t}\n\n\t\tconst reader = response.body.getReader();\n\t\tconst decoder = new TextDecoder();\n\n\t\ttry {\n\t\t\twhile (true) {\n\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\t\n\t\t\t\tif (done) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tconst chunk = decoder.decode(value, { stream: true });\n\t\t\t\tonChunk(chunk);\n\t\t\t}\n\t\t} finally {\n\t\t\treader.releaseLock();\n\t\t}\n\t}\n\n\tasync startClaudeInteractiveSetup(\n\t\trepoName: string,\n\t\tuserId = 'anonymous',\n\t\tstep = 'start'\n\t): Promise<{\n\t\tmessage: string;\n\t\tauthUrl?: string;\n\t\tstep: string;\n\t\tinstructions?: string[];\n\t\toutput?: string;\n\t\twarning?: string;\n\t\tconfigured?: boolean;\n\t\tneedsUserCode?: boolean;\n\t\tsessionId?: string;\n\t}> {\n\t\treturn this.request('/api/claude/interactive-setup', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ repoName, userId, step })\n\t\t});\n\t}\n\n\tasync verifyClaudeCode(\n\t\trepoName: string,\n\t\tverificationCode: string,\n\t\tsessionId: string,\n\t\tuserId = 'anonymous'\n\t): Promise<{\n\t\tmessage: string;\n\t\tstep: string;\n\t\tconfigured?: boolean;\n\t\terror?: string;\n\t}> {\n\t\treturn this.request('/api/claude/verify-code', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({ repoName, verificationCode, sessionId, userId })\n\t\t});\n\t}\n\n\tasync clearClaudeSession(\n\t\trepoName: string,\n\t\tuserId = 'anonymous'\n\t): Promise<{\n\t\tmessage: string;\n\t\tsessionId?: string;\n\t}> {\n\t\treturn this.request(`/api/claude/session/${userId}/${repoName}`, {\n\t\t\tmethod: 'DELETE'\n\t\t});\n\t}\n\n\tasync ensureUserContainer(\n\t\trepoName: string,\n\t\tuserId: string\n\t): Promise<{ message: string; containerName: string; status: string; volumeName: string }> {\n\t\treturn this.request(`/api/containers/${userId}/${repoName}/ensure`, {\n\t\t\tmethod: 'POST'\n\t\t});\n\t}\n}\n\nexport const apiClient = new ApiClient();\nexport default apiClient;\n","<script lang=\"ts\">\n\timport type { FileTreeItem } from '$types/api';\n\n\texport let item: FileTreeItem;\n\texport let depth: number = 0;\n\texport let expandedDirs: Set<string>;\n\texport let selectedFile: string | null;\n\texport let draggedItem: string | null;\n\texport let dragOverItem: string | null;\n\texport let isDragging: boolean;\n\texport let onToggleDirectory: (path: string) => void;\n\texport let onSelectFile: (path: string) => void;\n\texport let onContextMenu: (event: MouseEvent, path: string) => void;\n\texport let onDragStart: (path: string, event?: DragEvent) => void;\n\texport let onDragEnd: () => void;\n\texport let onDragOver: (path: string) => void;\n\texport let onDragLeave: (path: string) => void;\n\texport let onDrop: (path: string) => void;\n\texport let isValidDropTarget: (path: string) => boolean;\n\n\tfunction getFileIcon(item: FileTreeItem): string {\n\t\tif (item.type === 'directory') {\n\t\t\treturn expandedDirs.has(item.path) ? '📂' : '📁';\n\t\t}\n\n\t\tconst ext = item.name.split('.').pop()?.toLowerCase();\n\t\tswitch (ext) {\n\t\t\tcase 'tex':\n\t\t\t\treturn '📄';\n\t\t\tcase 'pdf':\n\t\t\t\treturn '📋';\n\t\t\tcase 'png':\n\t\t\tcase 'jpg':\n\t\t\tcase 'jpeg':\n\t\t\tcase 'gif':\n\t\t\t\treturn '🖼️';\n\t\t\tcase 'md':\n\t\t\t\treturn '📝';\n\t\t\tcase 'json':\n\t\t\t\treturn '⚙️';\n\t\t\tcase 'bib':\n\t\t\t\treturn '📚';\n\t\t\tdefault:\n\t\t\t\treturn '📄';\n\t\t}\n\t}\n\n\tfunction formatFileSize(bytes: number): string {\n\t\tif (bytes < 1024) return `${bytes} B`;\n\t\tif (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n\t\treturn `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n\t}\n</script>\n\n<div class=\"select-none\" style=\"margin-left: {depth * 16}px\">\n\t{#if item.type === 'directory'}\n\t\t<button\n\t\t\tdraggable=\"true\"\n\t\t\ton:click={() => onToggleDirectory(item.path)}\n\t\t\ton:contextmenu={(e) => onContextMenu(e, item.path)}\n\t\t\ton:dragstart={(e) => onDragStart(item.path, e)}\n\t\t\ton:dragend={onDragEnd}\n\t\t\ton:dragover|preventDefault={(e) => {\n\t\t\t\tif (draggedItem && draggedItem !== item.path && isValidDropTarget(item.path)) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tonDragOver(item.path);\n\t\t\t\t}\n\t\t\t}}\n\t\t\ton:dragleave={() => onDragLeave(item.path)}\n\t\t\ton:drop|preventDefault={() => {\n\t\t\t\tif (draggedItem && isValidDropTarget(item.path)) {\n\t\t\t\t\tonDrop(item.path);\n\t\t\t\t}\n\t\t\t}}\n\t\t\tclass=\"w-full text-left px-4 py-1 hover:bg-gray-700 transition-colors flex items-center text-sm text-gray-300 cursor-pointer\"\n\t\t\tclass:opacity-50={draggedItem === item.path}\n\t\t\tclass:bg-blue-500={dragOverItem === item.path && isDragging && isValidDropTarget(item.path)}\n\t\t\tclass:bg-opacity-20={dragOverItem === item.path && isDragging && isValidDropTarget(item.path)}\n\t\t\tclass:border-l-2={dragOverItem === item.path && isDragging && isValidDropTarget(item.path)}\n\t\t\tclass:border-blue-500={dragOverItem === item.path &&\n\t\t\t\tisDragging &&\n\t\t\t\tisValidDropTarget(item.path)}\n\t\t>\n\t\t\t<span class=\"w-4 text-xs\">{getFileIcon(item)}</span>\n\t\t\t<span class=\"ml-2 truncate\">{item.name}</span>\n\t\t</button>\n\t\t{#if expandedDirs.has(item.path) && item.children}\n\t\t\t{#each item.children as child}\n\t\t\t\t<svelte:self\n\t\t\t\t\titem={child}\n\t\t\t\t\tdepth={depth + 1}\n\t\t\t\t\t{expandedDirs}\n\t\t\t\t\t{selectedFile}\n\t\t\t\t\t{draggedItem}\n\t\t\t\t\t{dragOverItem}\n\t\t\t\t\t{isDragging}\n\t\t\t\t\t{onToggleDirectory}\n\t\t\t\t\t{onSelectFile}\n\t\t\t\t\t{onContextMenu}\n\t\t\t\t\t{onDragStart}\n\t\t\t\t\t{onDragEnd}\n\t\t\t\t\t{onDragOver}\n\t\t\t\t\t{onDragLeave}\n\t\t\t\t\t{onDrop}\n\t\t\t\t\t{isValidDropTarget}\n\t\t\t\t/>\n\t\t\t{/each}\n\t\t{/if}\n\t{:else}\n\t\t<button\n\t\t\tdraggable=\"true\"\n\t\t\ton:click={() => onSelectFile(item.path)}\n\t\t\ton:contextmenu={(e) => onContextMenu(e, item.path)}\n\t\t\ton:dragstart={(e) => onDragStart(item.path, e)}\n\t\t\ton:dragend={onDragEnd}\n\t\t\tclass=\"w-full text-left px-4 py-1 hover:bg-gray-700 transition-colors flex items-center justify-between text-sm group cursor-pointer\"\n\t\t\tclass:bg-blue-600={selectedFile === item.path}\n\t\t\tclass:text-white={selectedFile === item.path}\n\t\t\tclass:text-gray-300={selectedFile !== item.path}\n\t\t\tclass:opacity-50={draggedItem === item.path}\n\t\t>\n\t\t\t<div class=\"flex items-center min-w-0\">\n\t\t\t\t<span class=\"w-4 text-xs\">{getFileIcon(item)}</span>\n\t\t\t\t<span class=\"ml-2 truncate\">{item.name}</span>\n\t\t\t</div>\n\t\t\t{#if item.size !== undefined}\n\t\t\t\t<span class=\"text-xs text-gray-500 group-hover:text-gray-400 ml-2 flex-shrink-0\">\n\t\t\t\t\t{formatFileSize(item.size)}\n\t\t\t\t</span>\n\t\t\t{/if}\n\t\t</button>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { apiClient } from '$utils/api';\n\timport type { FileTreeItem } from '$types/api';\n\timport FileTreeNode from './FileTreeNode.svelte';\n\n\texport let repoName: string | null = null;\n\texport let userId: string = 'anonymous';\n\texport let onFileSelect: (filePath: string) => void = () => {};\n\n\tlet fileTree: FileTreeItem[] = [];\n\tlet expandedDirs = new Set<string>();\n\tlet selectedFile: string | null = null;\n\tlet loading = false;\n\tlet error: string | null = null;\n\n\t// File operations state\n\tlet showCreateFileDialog = false;\n\tlet showCreateFolderDialog = false;\n\tlet showRenameDialog = false;\n\tlet newFileName = '';\n\tlet newFolderName = '';\n\tlet renameOldPath = '';\n\tlet renameNewName = '';\n\tlet contextMenuPath = '';\n\tlet contextMenuVisible = false;\n\tlet contextMenuX = 0;\n\tlet contextMenuY = 0;\n\tlet operationInProgress = false;\n\n\t// Drag and drop state\n\tlet draggedItem: string | null = null;\n\tlet dragOverItem: string | null = null;\n\tlet isDragging = false;\n\n\tonMount(() => {\n\t\tif (repoName) {\n\t\t\tloadFileTree();\n\t\t}\n\t});\n\n\t$: if (repoName) {\n\t\tloadFileTree();\n\t}\n\n\tasync function loadFileTree(retryCount = 0) {\n\t\tif (!repoName) return;\n\n\t\tloading = true;\n\t\terror = null;\n\n\t\ttry {\n\t\t\tconst response = await apiClient.getFileTree(repoName, userId);\n\t\t\tfileTree = response.tree;\n\t\t\tconsole.log('File tree loaded successfully:', fileTree.length, 'items');\n\t\t} catch (err) {\n\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Failed to load file tree';\n\t\t\tconsole.error('File tree loading error:', errorMessage);\n\t\t\t\n\t\t\t// Check if this is a repository not ready error and we haven't retried too many times\n\t\t\tif ((errorMessage.includes('Repository is still being prepared') || \n\t\t\t\t errorMessage.includes('Repository not found') || \n\t\t\t\t errorMessage.includes('not found')) && retryCount < 3) {\n\t\t\t\tconsole.log(`Repository not ready, retrying in ${2 + retryCount} seconds... (attempt ${retryCount + 1}/3)`);\n\t\t\t\terror = `Repository is being prepared... (attempt ${retryCount + 1}/3)`;\n\t\t\t\t\n\t\t\t\t// Retry with exponential backoff\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tloadFileTree(retryCount + 1);\n\t\t\t\t}, (2 + retryCount) * 1000);\n\t\t\t} else if (errorMessage.includes('Repository is still being prepared') || \n\t\t\t\t\t   errorMessage.includes('Repository not found') || \n\t\t\t\t\t   errorMessage.includes('not found')) {\n\t\t\t\terror = 'Repository not ready. The cloning process may still be in progress. Please try refreshing the page.';\n\t\t\t} else {\n\t\t\t\terror = errorMessage;\n\t\t\t}\n\t\t} finally {\n\t\t\tif (retryCount === 0 || retryCount >= 3) {\n\t\t\t\tloading = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction toggleDirectory(path: string) {\n\t\tif (expandedDirs.has(path)) {\n\t\t\texpandedDirs.delete(path);\n\t\t} else {\n\t\t\texpandedDirs.add(path);\n\t\t}\n\t\texpandedDirs = new Set(expandedDirs); // Trigger reactivity\n\t}\n\n\tfunction selectFile(filePath: string) {\n\t\tselectedFile = filePath;\n\t\tonFileSelect(filePath);\n\t}\n\n\tfunction showContextMenu(e: MouseEvent, path: string) {\n\t\te.preventDefault();\n\t\tcontextMenuPath = path;\n\t\tcontextMenuX = e.clientX;\n\t\tcontextMenuY = e.clientY;\n\t\tcontextMenuVisible = true;\n\t}\n\n\tfunction hideContextMenu() {\n\t\tcontextMenuVisible = false;\n\t\tcontextMenuPath = '';\n\t}\n\n\tfunction openCreateFileDialog() {\n\t\tnewFileName = '';\n\t\tshowCreateFileDialog = true;\n\t\thideContextMenu();\n\t}\n\n\tfunction openCreateFolderDialog() {\n\t\tnewFolderName = '';\n\t\tshowCreateFolderDialog = true;\n\t\thideContextMenu();\n\t}\n\n\tfunction openRenameDialog(path: string) {\n\t\trenameOldPath = path;\n\t\trenameNewName = path.split('/').pop() || '';\n\t\tshowRenameDialog = true;\n\t\thideContextMenu();\n\t}\n\n\tasync function createFile() {\n\t\tif (!repoName || !newFileName.trim()) return;\n\n\t\toperationInProgress = true;\n\t\ttry {\n\t\t\tlet filePath = newFileName.trim();\n\t\t\tif (contextMenuPath && contextMenuPath !== '') {\n\t\t\t\t// If context menu was opened on a directory, create file inside it\n\t\t\t\tfilePath = `${contextMenuPath}/${filePath}`;\n\t\t\t}\n\n\t\t\tawait apiClient.createFile(repoName, filePath, '', userId);\n\t\t\tawait loadFileTree();\n\t\t\tshowCreateFileDialog = false;\n\t\t\tnewFileName = '';\n\t\t} catch (err) {\n\t\t\terror = err instanceof Error ? err.message : 'Failed to create file';\n\t\t} finally {\n\t\t\toperationInProgress = false;\n\t\t}\n\t}\n\n\tasync function createFolder() {\n\t\tif (!repoName || !newFolderName.trim()) return;\n\n\t\toperationInProgress = true;\n\t\ttry {\n\t\t\tlet folderPath = newFolderName.trim();\n\t\t\tif (contextMenuPath && contextMenuPath !== '') {\n\t\t\t\t// If context menu was opened on a directory, create folder inside it\n\t\t\t\tfolderPath = `${contextMenuPath}/${folderPath}`;\n\t\t\t}\n\n\t\t\tawait apiClient.createFolder(repoName, folderPath, userId);\n\t\t\tawait loadFileTree();\n\t\t\tshowCreateFolderDialog = false;\n\t\t\tnewFolderName = '';\n\t\t} catch (err) {\n\t\t\terror = err instanceof Error ? err.message : 'Failed to create folder';\n\t\t} finally {\n\t\t\toperationInProgress = false;\n\t\t}\n\t}\n\n\tasync function renameItem() {\n\t\tif (!repoName || !renameNewName.trim() || !renameOldPath) return;\n\n\t\toperationInProgress = true;\n\t\ttry {\n\t\t\tconst pathParts = renameOldPath.split('/');\n\t\t\tpathParts[pathParts.length - 1] = renameNewName.trim();\n\t\t\tconst newPath = pathParts.join('/');\n\n\t\t\tawait apiClient.renameFile(repoName, renameOldPath, newPath, userId);\n\t\t\tawait loadFileTree();\n\t\t\tshowRenameDialog = false;\n\t\t\trenameOldPath = '';\n\t\t\trenameNewName = '';\n\t\t} catch (err) {\n\t\t\terror = err instanceof Error ? err.message : 'Failed to rename item';\n\t\t} finally {\n\t\t\toperationInProgress = false;\n\t\t}\n\t}\n\n\tasync function deleteItem(path: string) {\n\t\tif (!repoName || !path) return;\n\t\tif (!confirm(`Are you sure you want to delete \"${path}\"?`)) return;\n\n\t\toperationInProgress = true;\n\t\ttry {\n\t\t\tawait apiClient.deleteFile(repoName, path, userId);\n\t\t\tawait loadFileTree();\n\t\t\thideContextMenu();\n\t\t} catch (err) {\n\t\t\terror = err instanceof Error ? err.message : 'Failed to delete item';\n\t\t} finally {\n\t\t\toperationInProgress = false;\n\t\t}\n\t}\n\n\t// Close context menu when clicking elsewhere\n\tfunction handleGlobalClick(e: MouseEvent) {\n\t\tif (contextMenuVisible) {\n\t\t\tconst target = e.target as HTMLElement;\n\t\t\tif (!target.closest('.context-menu')) {\n\t\t\t\thideContextMenu();\n\t\t\t}\n\t\t}\n\t}\n\n\t// Drag and drop handlers\n\tfunction handleDragStart(path: string, event?: DragEvent) {\n\t\tdraggedItem = path;\n\t\tisDragging = true;\n\t\thideContextMenu();\n\n\t\t// Add dragging class to body for cursor styling\n\t\tdocument.body.classList.add('dragging');\n\n\t\t// Set drag effect\n\t\tif (event?.dataTransfer) {\n\t\t\tevent.dataTransfer.effectAllowed = 'move';\n\t\t\tconst fileName = path.split('/').pop() || path;\n\t\t\tevent.dataTransfer.setData('text/plain', fileName);\n\t\t}\n\t}\n\n\tfunction handleDragEnd() {\n\t\tdraggedItem = null;\n\t\tdragOverItem = null;\n\t\tisDragging = false;\n\n\t\t// Remove dragging class from body\n\t\tdocument.body.classList.remove('dragging');\n\t}\n\n\tfunction handleDragOver(path: string) {\n\t\tif (draggedItem && draggedItem !== path) {\n\t\t\tdragOverItem = path;\n\t\t}\n\t}\n\n\tfunction handleDragLeave(path: string) {\n\t\tif (dragOverItem === path) {\n\t\t\tdragOverItem = null;\n\t\t}\n\t}\n\n\tasync function handleDrop(targetPath: string) {\n\t\tif (!draggedItem || !repoName || draggedItem === targetPath) {\n\t\t\tdraggedItem = null;\n\t\t\tdragOverItem = null;\n\t\t\tisDragging = false;\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if trying to drop into itself or a child\n\t\tif (targetPath.startsWith(draggedItem + '/')) {\n\t\t\tdraggedItem = null;\n\t\t\tdragOverItem = null;\n\t\t\tisDragging = false;\n\t\t\treturn;\n\t\t}\n\n\t\toperationInProgress = true;\n\t\ttry {\n\t\t\tconst draggedName = draggedItem.split('/').pop() || '';\n\t\t\tconst newPath = targetPath ? `${targetPath}/${draggedName}` : draggedName;\n\n\t\t\t// Don't move if it's the same location\n\t\t\tif (draggedItem === newPath) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait apiClient.renameFile(repoName, draggedItem, newPath, userId);\n\t\t\tawait loadFileTree();\n\n\t\t\t// Update selected file path if it was the moved file\n\t\t\tif (selectedFile === draggedItem) {\n\t\t\t\tselectedFile = newPath;\n\t\t\t\tonFileSelect(newPath);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\terror = err instanceof Error ? err.message : 'Failed to move item';\n\t\t} finally {\n\t\t\toperationInProgress = false;\n\t\t\tdraggedItem = null;\n\t\t\tdragOverItem = null;\n\t\t\tisDragging = false;\n\t\t}\n\t}\n\n\t// Helper function to find item by path\n\tfunction findItemByPath(items: FileTreeItem[], path: string): FileTreeItem | null {\n\t\tfor (const item of items) {\n\t\t\tif (item.path === path) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t\tif (item.children) {\n\t\t\t\tconst found = findItemByPath(item.children, path);\n\t\t\t\tif (found) return found;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\t// Check if target is a valid drop zone (directory)\n\tfunction isValidDropTarget(targetPath: string): boolean {\n\t\tif (!targetPath) return true; // Root is always valid\n\t\tconst targetItem = findItemByPath(fileTree, targetPath);\n\t\treturn targetItem?.type === 'directory';\n\t}\n</script>\n\n<svelte:window on:click={handleGlobalClick} />\n\n<div class=\"h-full flex flex-col bg-dark-800\">\n\t<div class=\"p-4 border-b border-gray-700\">\n\t\t<div class=\"flex items-center justify-between\">\n\t\t\t<div>\n\t\t\t\t<h3 class=\"text-gray-300 font-medium flex items-center\">\n\t\t\t\t\t<span class=\"mr-2\">📁</span>\n\t\t\t\t\tFile Explorer\n\t\t\t\t</h3>\n\t\t\t\t{#if repoName}\n\t\t\t\t\t<p class=\"text-xs text-gray-400 mt-1 truncate\">{repoName}</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t{#if repoName}\n\t\t\t\t<div class=\"flex space-x-1\">\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => loadFileTree()}\n\t\t\t\t\t\tclass=\"p-1 text-gray-400 hover:text-white hover:bg-gray-600 rounded transition-colors\"\n\t\t\t\t\t\ttitle=\"Refresh Files\"\n\t\t\t\t\t\taria-label=\"Refresh Files\"\n\t\t\t\t\t\tdisabled={loading || operationInProgress}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\td=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={openCreateFileDialog}\n\t\t\t\t\t\tclass=\"p-1 text-gray-400 hover:text-white hover:bg-gray-600 rounded transition-colors\"\n\t\t\t\t\t\ttitle=\"New File\"\n\t\t\t\t\t\taria-label=\"New File\"\n\t\t\t\t\t\tdisabled={operationInProgress}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\td=\"M12 6v6m0 0v6m0-6h6m-6 0H6\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={openCreateFolderDialog}\n\t\t\t\t\t\tclass=\"p-1 text-gray-400 hover:text-white hover:bg-gray-600 rounded transition-colors\"\n\t\t\t\t\t\ttitle=\"New Folder\"\n\t\t\t\t\t\taria-label=\"New Folder\"\n\t\t\t\t\t\tdisabled={operationInProgress}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\td=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-5l-2-2H5a2 2 0 00-2 2z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\n\t<div\n\t\trole=\"region\"\n\t\taria-label=\"File tree drop zone\"\n\t\tclass=\"flex-1 overflow-y-auto\"\n\t\ton:dragover|preventDefault={(e) => {\n\t\t\tif (draggedItem) {\n\t\t\t\te.preventDefault();\n\t\t\t\thandleDragOver('');\n\t\t\t}\n\t\t}}\n\t\ton:dragleave={(e) => {\n\t\t\tif (e.currentTarget === e.target) {\n\t\t\t\thandleDragLeave('');\n\t\t\t}\n\t\t}}\n\t\ton:drop|preventDefault={() => handleDrop('')}\n\t\tclass:bg-blue-500={dragOverItem === '' && isDragging}\n\t\tclass:bg-opacity-10={dragOverItem === '' && isDragging}\n\t\tclass:border-2={dragOverItem === '' && isDragging}\n\t\tclass:border-blue-500={dragOverItem === '' && isDragging}\n\t\tclass:border-dashed={dragOverItem === '' && isDragging}\n\t\tclass:rounded={dragOverItem === '' && isDragging}\n\t\tclass:m-1={dragOverItem === '' && isDragging}\n\t>\n\t\t{#if dragOverItem === '' && isDragging}\n\t\t\t<div class=\"p-4 text-center text-blue-400 text-sm\">\n\t\t\t\t<p>📁 Drop here to move to root folder</p>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if loading}\n\t\t\t<div class=\"p-4 text-center\">\n\t\t\t\t<div class=\"loading-spinner mx-auto mb-2\"></div>\n\t\t\t\t<p class=\"text-gray-400 text-sm\">Loading files...</p>\n\t\t\t</div>\n\t\t{:else if error}\n\t\t\t<div class=\"p-4 text-center\">\n\t\t\t\t<p class=\"text-red-400 text-sm mb-2\">⚠️ Error loading files</p>\n\t\t\t\t<p class=\"text-gray-400 text-xs\">{error}</p>\n\t\t\t\t<button\n\t\t\t\t\ton:click={() => loadFileTree()}\n\t\t\t\t\tclass=\"mt-2 text-blue-400 hover:text-blue-300 text-sm underline\"\n\t\t\t\t>\n\t\t\t\t\tRetry\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{:else if !repoName}\n\t\t\t<div class=\"p-4 text-center text-gray-400 text-sm\">\n\t\t\t\t<p>📂</p>\n\t\t\t\t<p class=\"mt-2\">No repository loaded</p>\n\t\t\t</div>\n\t\t{:else if fileTree.length === 0}\n\t\t\t<div class=\"p-4 text-center text-gray-400 text-sm\">\n\t\t\t\t<p>📭</p>\n\t\t\t\t<p class=\"mt-2\">Repository is empty</p>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t{#each fileTree as item}\n\t\t\t\t<FileTreeNode\n\t\t\t\t\t{item}\n\t\t\t\t\tdepth={0}\n\t\t\t\t\t{expandedDirs}\n\t\t\t\t\t{selectedFile}\n\t\t\t\t\t{draggedItem}\n\t\t\t\t\t{dragOverItem}\n\t\t\t\t\t{isDragging}\n\t\t\t\t\tonToggleDirectory={toggleDirectory}\n\t\t\t\t\tonSelectFile={selectFile}\n\t\t\t\t\tonContextMenu={showContextMenu}\n\t\t\t\t\tonDragStart={handleDragStart}\n\t\t\t\t\tonDragEnd={handleDragEnd}\n\t\t\t\t\tonDragOver={handleDragOver}\n\t\t\t\t\tonDragLeave={handleDragLeave}\n\t\t\t\t\tonDrop={handleDrop}\n\t\t\t\t\t{isValidDropTarget}\n\t\t\t\t/>\n\t\t\t{/each}\n\t\t{/if}\n\t</div>\n\n\t<!-- Context Menu -->\n\t{#if contextMenuVisible}\n\t\t<div\n\t\t\tclass=\"context-menu fixed bg-dark-700 border border-gray-600 rounded shadow-lg py-1 z-50\"\n\t\t\tstyle=\"left: {contextMenuX}px; top: {contextMenuY}px;\"\n\t\t>\n\t\t\t<button\n\t\t\t\ton:click={() => openRenameDialog(contextMenuPath)}\n\t\t\t\tclass=\"block w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-600 transition-colors\"\n\t\t\t>\n\t\t\t\tRename\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ton:click={() => deleteItem(contextMenuPath)}\n\t\t\t\tclass=\"block w-full text-left px-3 py-2 text-sm text-red-400 hover:bg-gray-600 transition-colors\"\n\t\t\t>\n\t\t\t\tDelete\n\t\t\t</button>\n\t\t\t<hr class=\"border-gray-600 my-1\" />\n\t\t\t<button\n\t\t\t\ton:click={openCreateFileDialog}\n\t\t\t\tclass=\"block w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-600 transition-colors\"\n\t\t\t>\n\t\t\t\tNew File\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ton:click={openCreateFolderDialog}\n\t\t\t\tclass=\"block w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-600 transition-colors\"\n\t\t\t>\n\t\t\t\tNew Folder\n\t\t\t</button>\n\t\t</div>\n\t{/if}\n\n\t<!-- Create File Dialog -->\n\t{#if showCreateFileDialog}\n\t\t<div class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n\t\t\t<div class=\"bg-dark-700 border border-gray-600 rounded-lg p-6 w-96\">\n\t\t\t\t<h3 class=\"text-lg font-medium text-white mb-4\">Create New File</h3>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={newFileName}\n\t\t\t\t\tplaceholder=\"Enter file name (e.g., document.tex)\"\n\t\t\t\t\tclass=\"w-full px-3 py-2 bg-dark-800 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:border-blue-500\"\n\t\t\t\t\ton:keydown={(e) => e.key === 'Enter' && createFile()}\n\t\t\t\t/>\n\t\t\t\t<div class=\"flex space-x-3 mt-4\">\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={createFile}\n\t\t\t\t\t\tdisabled={!newFileName.trim() || operationInProgress}\n\t\t\t\t\t\tclass=\"btn-primary px-4 py-2 text-sm disabled:opacity-50\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{operationInProgress ? 'Creating...' : 'Create'}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => (showCreateFileDialog = false)}\n\t\t\t\t\t\tdisabled={operationInProgress}\n\t\t\t\t\t\tclass=\"px-4 py-2 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors disabled:opacity-50\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<!-- Create Folder Dialog -->\n\t{#if showCreateFolderDialog}\n\t\t<div class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n\t\t\t<div class=\"bg-dark-700 border border-gray-600 rounded-lg p-6 w-96\">\n\t\t\t\t<h3 class=\"text-lg font-medium text-white mb-4\">Create New Folder</h3>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={newFolderName}\n\t\t\t\t\tplaceholder=\"Enter folder name\"\n\t\t\t\t\tclass=\"w-full px-3 py-2 bg-dark-800 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:border-blue-500\"\n\t\t\t\t\ton:keydown={(e) => e.key === 'Enter' && createFolder()}\n\t\t\t\t/>\n\t\t\t\t<div class=\"flex space-x-3 mt-4\">\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={createFolder}\n\t\t\t\t\t\tdisabled={!newFolderName.trim() || operationInProgress}\n\t\t\t\t\t\tclass=\"btn-primary px-4 py-2 text-sm disabled:opacity-50\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{operationInProgress ? 'Creating...' : 'Create'}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => (showCreateFolderDialog = false)}\n\t\t\t\t\t\tdisabled={operationInProgress}\n\t\t\t\t\t\tclass=\"px-4 py-2 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors disabled:opacity-50\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<!-- Rename Dialog -->\n\t{#if showRenameDialog}\n\t\t<div class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n\t\t\t<div class=\"bg-dark-700 border border-gray-600 rounded-lg p-6 w-96\">\n\t\t\t\t<h3 class=\"text-lg font-medium text-white mb-4\">Rename Item</h3>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={renameNewName}\n\t\t\t\t\tplaceholder=\"Enter new name\"\n\t\t\t\t\tclass=\"w-full px-3 py-2 bg-dark-800 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:border-blue-500\"\n\t\t\t\t\ton:keydown={(e) => e.key === 'Enter' && renameItem()}\n\t\t\t\t/>\n\t\t\t\t<div class=\"flex space-x-3 mt-4\">\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={renameItem}\n\t\t\t\t\t\tdisabled={!renameNewName.trim() || operationInProgress}\n\t\t\t\t\t\tclass=\"btn-primary px-4 py-2 text-sm disabled:opacity-50\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{operationInProgress ? 'Renaming...' : 'Rename'}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => (showRenameDialog = false)}\n\t\t\t\t\t\tdisabled={operationInProgress}\n\t\t\t\t\t\tclass=\"px-4 py-2 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors disabled:opacity-50\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t/* Drag and drop styles */\n\t:global(.dragging) {\n\t\tcursor: grabbing !important;\n\t}\n\n\t:global(.drag-over) {\n\t\tbackground-color: rgba(59, 130, 246, 0.1);\n\t\tborder-left: 2px solid rgb(59, 130, 246);\n\t}\n\n\t/* Custom drag ghost styles */\n\t:global(.drag-ghost) {\n\t\tbackground: rgba(0, 0, 0, 0.8);\n\t\tcolor: white;\n\t\tpadding: 4px 8px;\n\t\tborder-radius: 4px;\n\t\tfont-size: 12px;\n\t\tpointer-events: none;\n\t}\n</style>\n","<script lang=\"ts\">\n\texport let pdfUrl: string | null = null;\n\texport let isLoading = false;\n\texport let error: string | null = null;\n\n\tlet iframeElement: HTMLIFrameElement;\n\tlet loadError = false;\n\n\tfunction handleIframeLoad() {\n\t\tloadError = false;\n\t}\n\n\tfunction handleIframeError() {\n\t\tloadError = true;\n\t}\n\n\tfunction refreshPdf() {\n\t\tif (iframeElement && pdfUrl) {\n\t\t\t// Use PDF.js viewer with configuration for right-side thumbnails\n\t\t\tconst timestamp = Date.now();\n\t\t\tconst pdfJsUrl = `/pdfjs/web/viewer.html?file=${encodeURIComponent(pdfUrl)}&t=${timestamp}`;\n\t\t\tiframeElement.src = pdfJsUrl;\n\t\t}\n\t}\n\n\tfunction getPdfUrlWithPdfJs(baseUrl: string): string {\n\t\t// Use PDF.js viewer with custom right-side thumbnail configuration\n\t\treturn `/pdfjs/web/viewer.html?file=${encodeURIComponent(baseUrl)}`;\n\t}\n\n\t// Refresh PDF when URL changes\n\t$: if (pdfUrl && iframeElement) {\n\t\trefreshPdf();\n\t}\n</script>\n\n<div\n\tclass=\"h-full flex flex-col bg-gray-100\"\n\tstyle=\"contain: layout style; transform: translateZ(0);\"\n>\n\t<div class=\"flex-1 relative\">\n\t\t{#if isLoading}\n\t\t\t<div class=\"absolute inset-0 flex items-center justify-center bg-gray-50\">\n\t\t\t\t<div class=\"text-center\">\n\t\t\t\t\t<div class=\"loading-spinner mx-auto mb-4 w-8 h-8\"></div>\n\t\t\t\t\t<p class=\"text-gray-600\">Compiling PDF...</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else if error}\n\t\t\t<div class=\"absolute inset-0 flex items-center justify-center bg-red-50\">\n\t\t\t\t<div class=\"text-center max-w-md mx-auto p-6\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclass=\"w-16 h-16 mx-auto mb-4 text-red-400\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<h3 class=\"text-lg font-medium text-red-800 mb-2\">Compilation Error</h3>\n\t\t\t\t\t<p class=\"text-red-600 text-sm mb-4\">{error}</p>\n\t\t\t\t\t<p class=\"text-xs text-gray-500\">\n\t\t\t\t\t\tInstall LaTeX (TeX Live) or Docker for full compilation support.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else if !pdfUrl}\n\t\t\t<div class=\"absolute inset-0 flex items-center justify-center\">\n\t\t\t\t<div class=\"text-center text-gray-600\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclass=\"w-16 h-16 mx-auto mb-4 text-gray-400\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<p class=\"text-lg font-medium mb-2\">PDF Preview</p>\n\t\t\t\t\t<p class=\"text-sm\">Compile your LaTeX document to see the preview</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else if loadError}\n\t\t\t<div class=\"absolute inset-0 flex items-center justify-center bg-yellow-50\">\n\t\t\t\t<div class=\"text-center max-w-md mx-auto p-6\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclass=\"w-16 h-16 mx-auto mb-4 text-yellow-500\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<h3 class=\"text-lg font-medium text-yellow-800 mb-2\">PDF Load Error</h3>\n\t\t\t\t\t<p class=\"text-yellow-700 text-sm mb-4\">Unable to display the PDF file.</p>\n\t\t\t\t\t<button on:click={refreshPdf} class=\"text-blue-600 hover:text-blue-500 underline text-sm\">\n\t\t\t\t\t\tTry Again\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<iframe\n\t\t\t\tbind:this={iframeElement}\n\t\t\t\tsrc={getPdfUrlWithPdfJs(pdfUrl)}\n\t\t\t\ton:load={handleIframeLoad}\n\t\t\t\ton:error={handleIframeError}\n\t\t\t\tclass=\"w-full h-full border-0\"\n\t\t\t\tstyle=\"transform: translateZ(0); will-change: auto;\"\n\t\t\t\ttitle=\"PDF Preview\"\n\t\t\t></iframe>\n\t\t{/if}\n\t</div>\n\n\t{#if pdfUrl && !isLoading && !error}\n\t\t<div\n\t\t\tclass=\"bg-gray-200 px-4 py-2 border-t border-gray-300 flex items-center justify-between text-sm\"\n\t\t>\n\t\t\t<span class=\"text-gray-600\">PDF Preview</span>\n\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t<button\n\t\t\t\t\ton:click={refreshPdf}\n\t\t\t\t\tclass=\"text-gray-600 hover:text-gray-800 transition-colors\"\n\t\t\t\t\ttitle=\"Refresh PDF\"\n\t\t\t\t\taria-label=\"Refresh PDF\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<a\n\t\t\t\t\thref={getPdfUrlWithPdfJs(pdfUrl)}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\tclass=\"text-gray-600 hover:text-gray-800 transition-colors\"\n\t\t\t\t\ttitle=\"Open in new tab\"\n\t\t\t\t\taria-label=\"Open PDF in new tab\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n  import { createEventDispatcher } from 'svelte';\n  \n  export let isOpen = false;\n  export let authUrl = '';\n  export let sessionId = '';\n  export let isLoading = false; // Now comes from parent\n  \n  const dispatch = createEventDispatcher();\n  \n  let verificationCode = '';\n  let error = '';\n  \n  function closeModal() {\n    if (!isLoading) {\n      isOpen = false;\n      verificationCode = '';\n      error = '';\n      dispatch('cancel');\n    }\n  }\n  \n  async function handleSubmit() {\n    if (!verificationCode.trim()) {\n      error = 'Please enter the verification code';\n      return;\n    }\n    \n    error = '';\n    \n    try {\n      dispatch('submit', { verificationCode: verificationCode.trim(), sessionId });\n      // isLoading state is now managed by parent component\n    } catch (err) {\n      error = 'Failed to submit code. Please try again.';\n    }\n  }\n  \n  function handleKeydown(event: KeyboardEvent) {\n    if (event.key === 'Escape' && !isLoading) {\n      closeModal();\n    }\n    if (event.key === 'Enter' && !isLoading) {\n      handleSubmit();\n    }\n  }\n  \n  function openAuthUrl() {\n    if (authUrl) {\n      window.open(authUrl, '_blank');\n    }\n  }\n</script>\n\n<svelte:window on:keydown={handleKeydown} />\n\n{#if isOpen}\n  <!-- Full screen modal overlay -->\n  <div \n    class=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4\"\n    on:click={closeModal}\n    on:keydown={(e) => e.key === 'Escape' && closeModal()}\n    role=\"dialog\"\n    aria-modal=\"true\"\n    aria-labelledby=\"claude-code-modal-title\"\n    tabindex=\"0\"\n  >\n    <!-- Modal content -->\n    <div \n      class=\"bg-white/95 backdrop-blur-glass rounded-3xl p-8 w-full max-w-lg shadow-3xl border border-white/20 relative\"\n      on:click|stopPropagation\n      role=\"none\"\n    >\n      <!-- Close button -->\n      <button\n        on:click={closeModal}\n        disabled={isLoading}\n        class=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50\"\n        aria-label=\"Close modal\"\n      >\n        <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\n        </svg>\n      </button>\n\n      <div class=\"text-center mb-6\">\n        <div class=\"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4\">\n          <svg class=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n          </svg>\n        </div>\n        <h2 id=\"claude-code-modal-title\" class=\"text-2xl font-bold text-gray-800 mb-2\">\n          Claude Authentication\n        </h2>\n        <p class=\"text-gray-600 text-sm leading-relaxed\">\n          Complete the authentication process by entering your verification code\n        </p>\n      </div>\n\n      <!-- Authentication URL -->\n      <div class=\"mb-6\">\n        <h3 class=\"text-sm font-medium text-gray-700 mb-3\">Step 1: Complete Authentication</h3>\n        <div class=\"bg-blue-50 rounded-2xl p-4 mb-4\">\n          <p class=\"text-sm text-blue-800 mb-3\">\n            Click the button below to open Claude authentication in a new tab:\n          </p>\n          <button\n            on:click={openAuthUrl}\n            disabled={isLoading}\n            class=\"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-xl text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            🔗 Open Claude Authentication\n          </button>\n        </div>\n      </div>\n\n      <!-- Verification Code Input -->\n      <div class=\"mb-6\">\n        <h3 class=\"text-sm font-medium text-gray-700 mb-3\">Step 2: Enter Verification Code</h3>\n        <div>\n          <label for=\"verification-code\" class=\"block text-sm font-medium text-gray-700 mb-2\">\n            Verification Code\n          </label>\n          <input\n            id=\"verification-code\"\n            type=\"text\"\n            bind:value={verificationCode}\n            placeholder=\"Enter the code from Claude authentication\"\n            disabled={isLoading}\n            class=\"w-full px-4 py-3 bg-white/70 border border-gray-200 rounded-2xl text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all disabled:opacity-50\"\n            autocomplete=\"off\"\n          />\n        </div>\n        \n        {#if error}\n          <div class=\"mt-2 text-sm text-red-600\">\n            {error}\n          </div>\n        {/if}\n      </div>\n\n      <!-- Instructions -->\n      <div class=\"mb-6 text-xs text-gray-500 leading-relaxed\">\n        <p class=\"mb-1\">💡 <strong>Instructions:</strong></p>\n        <p class=\"mb-1\">1. Click \"Open Claude Authentication\" above</p>\n        <p class=\"mb-1\">2. Sign in with your Claude Pro account</p>\n        <p class=\"mb-1\">3. Copy the verification code you receive</p>\n        <p class=\"mb-1\">4. Paste it in the field above and click \"Complete Setup\"</p>\n        <p>🔒 This process securely connects Claude AI to your account</p>\n      </div>\n\n      <!-- Action buttons -->\n      <div class=\"flex space-x-3\">\n        <button\n          on:click={closeModal}\n          disabled={isLoading}\n          class=\"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-2xl hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium\"\n        >\n          Cancel\n        </button>\n        <button\n          on:click={handleSubmit}\n          disabled={isLoading || !verificationCode.trim()}\n          class=\"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-4 py-3 rounded-2xl transition-all disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center space-x-2\"\n        >\n          {#if isLoading}\n            <svg class=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n              <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n              <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n            </svg>\n            Submitting...\n          {:else}\n            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n            </svg>\n            Complete Setup\n          {/if}\n        </button>\n      </div>\n    </div>\n  </div>\n{/if} ","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport FileTree from '$components/FileTree.svelte';\n\timport PdfPreview from '$components/PdfPreview.svelte';\n\timport AiChatPanel from '$components/AiChatPanel.svelte';\n\timport ClaudeCodeModal from '$components/ClaudeCodeModal.svelte';\n\timport { apiClient } from '$lib/utils/api';\n\timport { authStore } from '$lib/stores/auth';\n\timport type { GitStatusResponse } from '$lib/types/api';\n\t\n\t// Simple diff calculation function\n\tfunction calculateDiff(originalText: string, newText: string) {\n\t\tconst originalLines = originalText.split('\\n');\n\t\tconst newLines = newText.split('\\n');\n\t\tconst diff = [];\n\t\t\n\t\t// Simple line-by-line diff - we can enhance this later\n\t\tconst maxLines = Math.max(originalLines.length, newLines.length);\n\t\t\n\t\tfor (let i = 0; i < maxLines; i++) {\n\t\t\tconst originalLine = originalLines[i];\n\t\t\tconst newLine = newLines[i];\n\t\t\t\n\t\t\tif (originalLine === undefined) {\n\t\t\t\t// Addition\n\t\t\t\tdiff.push({ type: 'addition', line: newLine, lineNumber: i + 1 });\n\t\t\t} else if (newLine === undefined) {\n\t\t\t\t// Deletion\n\t\t\t\tdiff.push({ type: 'deletion', line: originalLine, lineNumber: i + 1 });\n\t\t\t} else if (originalLine !== newLine) {\n\t\t\t\t// Modification\n\t\t\t\tdiff.push({ type: 'deletion', line: originalLine, lineNumber: i + 1 });\n\t\t\t\tdiff.push({ type: 'addition', line: newLine, lineNumber: i + 1 });\n\t\t\t} else {\n\t\t\t\t// No change\n\t\t\t\tdiff.push({ type: 'context', line: originalLine, lineNumber: i + 1 });\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn diff;\n\t}\n\n\t// Function to detect if a tool call is an Edit and calculate diff\n\tfunction processEditToolCall(toolCall: { name: string; arguments: any }) {\n\t\tif (toolCall.name === 'Edit' && toolCall.arguments.file_path && toolCall.arguments.old_string && toolCall.arguments.new_string) {\n\t\t\ttry {\n\t\t\t\t// Get current file content to calculate full context\n\t\t\t\tconst currentFileContent = monacoEditor ? monacoEditor.getValue() : '';\n\t\t\t\tconst filePath = toolCall.arguments.file_path;\n\t\t\t\t\n\t\t\t\t// For now, we'll create a simple diff of the old_string -> new_string change\n\t\t\t\t// In a full implementation, we'd find the context in the file\n\t\t\t\tconst diff = calculateDiff(toolCall.arguments.old_string, toolCall.arguments.new_string);\n\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t\tfilePath,\n\t\t\t\t\toldString: toolCall.arguments.old_string,\n\t\t\t\t\tnewString: toolCall.arguments.new_string,\n\t\t\t\t\tdiff,\n\t\t\t\t\tapplied: false\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error processing edit tool call:', error);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tlet editorContainer: HTMLDivElement;\n\tlet monacoEditor: any = null; // eslint-disable-line @typescript-eslint/no-explicit-any\n\tlet monaco: any = null; // eslint-disable-line @typescript-eslint/no-explicit-any\n\tlet isCompiling = false;\n\tlet compileError: string | null = null;\n\tlet compileSuccess = false;\n\tlet currentRepoName: string | null = null;\n\tlet currentFilePath: string | null = null;\n\tlet unsavedChanges = false;\n\tlet autoSaveTimeout: ReturnType<typeof setTimeout> | null = null;\n\tlet pdfUrl: string | null = null;\n\n\t// Layout state\n\tlet layoutMode: 'both' | 'editor' | 'pdf' = 'both';\n\tlet fileTreeWidth = 256; // 16rem in pixels\n\tlet editorWidth = 50; // percentage for editor when in 'both' mode\n\tlet isResizing = false;\n\tlet resizingPanel: 'filetree' | 'editor-pdf' | 'git-split' | 'ai-chat' | null = null;\n\tlet gitPanelHeight = 40; // percentage for git panel height within sidebar\n\n\t// AI Chat Panel state\n\tlet showAiChat = false;\n\tlet aiChatHeight = 400; // Default height in pixels\n\tlet aiChatMessages: Array<{ \n\t\trole: 'user' | 'assistant'; \n\t\tcontent: string; \n\t\ttimestamp: Date;\n\t\tcontentBlocks?: Array<{ \n\t\t\ttype: 'text' | 'tool_call'; \n\t\t\tcontent?: string; \n\t\t\ttoolCall?: { name: string; id: string; arguments: any; expanded?: boolean; editDiff?: any };\n\t\t}>;\n\t}> = [];\n\tlet aiChatLoading = false;\n\n\t// Claude Code Modal state\n\tlet showClaudeCodeModal = false;\n\tlet claudeAuthUrl = '';\n\tlet claudeSessionId = '';\n\tlet claudeCodeSubmitting = false;\n\n\t// Git state\n\tlet gitStatus: GitStatusResponse | null = null;\n\tlet isCommitting = false;\n\tlet isPushing = false;\n\tlet isFetching = false;\n\tlet isPulling = false;\n\tlet commitMessage = '';\n\tlet commitSuccess = false;\n\tlet pushSuccess = false;\n\tlet fetchSuccess = false;\n\tlet pullSuccess = false;\n\tlet gitError: string | null = null;\n\n\t// Reactive statement to handle layout mode changes\n\t$: if (monacoEditor && (layoutMode === 'editor' || layoutMode === 'both')) {\n\t\t// Use a small delay to ensure DOM has updated\n\t\tsetTimeout(() => {\n\t\t\tif (monacoEditor && editorContainer) {\n\t\t\t\tconst rect = editorContainer.getBoundingClientRect();\n\t\t\t\tif (rect.width > 0 && rect.height > 0) {\n\t\t\t\t\tmonacoEditor.layout();\n\t\t\t\t}\n\t\t\t}\n\t\t}, 50);\n\t}\n\n\t// Get current user ID\n\tfunction getCurrentUserId(): string {\n\t\treturn $authStore.user?.id || 'anonymous';\n\t}\n\n\t// Get repo name from URL params or localStorage\n\tonMount(async () => {\n\t\t// Try to get repository name from URL params or localStorage\n\t\tconst searchParams = new URLSearchParams(window.location.search);\n\t\tcurrentRepoName = searchParams.get('repo') || localStorage.getItem('currentRepo');\n\n\t\tif (!currentRepoName) {\n\t\t\t// Redirect to home if no repository is specified\n\t\t\tgoto('/');\n\t\t\treturn;\n\t\t}\n\n\t\t// Ensure the user's container is running for this repository\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tconsole.log(`Ensuring container is running for user ${userId} with repo ${currentRepoName}`);\n\t\t\tconst containerInfo = await apiClient.ensureUserContainer(currentRepoName, userId);\n\t\t\tconsole.log('Container ready:', containerInfo);\n\n\t\t\t// Verify repository is accessible by trying to get file tree\n\t\t\ttry {\n\t\t\t\tawait apiClient.getFileTree(currentRepoName, userId);\n\t\t\t\tconsole.log('Repository verified and accessible');\n\t\t\t} catch (fileTreeError) {\n\t\t\t\tconsole.error('Repository not accessible, may need to be cloned:', fileTreeError);\n\t\t\t\tcompileError =\n\t\t\t\t\t'Repository not found. Please return to home and clone the repository again.';\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to ensure container is running:', error);\n\t\t\tcompileError = 'Failed to initialize repository environment. Please try again.';\n\t\t}\n\n\t\tawait initializeMonaco();\n\n\t\t// Load git status on mount\n\t\tawait handleRefreshGitStatus();\n\t});\n\n\tasync function initializeMonaco() {\n\t\ttry {\n\t\t\tconst monacoLoader = await import('@monaco-editor/loader');\n\t\t\tmonacoLoader.default.config({\n\t\t\t\tpaths: {\n\t\t\t\t\tvs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tmonaco = await monacoLoader.default.init();\n\n\t\t\t// Register LaTeX language if not already registered\n\t\t\tif (!monaco.languages.getLanguages().find((lang: any) => lang.id === 'latex')) {\n\t\t\t\tmonaco.languages.register({ id: 'latex' });\n\n\t\t\t\t// Basic LaTeX syntax highlighting\n\t\t\t\tmonaco.languages.setMonarchTokensProvider('latex', {\n\t\t\t\t\ttokenizer: {\n\t\t\t\t\t\troot: [\n\t\t\t\t\t\t\t[/\\\\[a-zA-Z@]+/, 'keyword'],\n\t\t\t\t\t\t\t[/\\{[^}]*\\}/, 'string'],\n\t\t\t\t\t\t\t[/%.*$/, 'comment'],\n\t\t\t\t\t\t\t[/\\$[^$]*\\$/, 'number'], // Math mode\n\t\t\t\t\t\t\t[/\\$\\$[^$]*\\$\\$/, 'number'] // Display math\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmonacoEditor = monaco.editor.create(editorContainer, {\n\t\t\t\tvalue:\n\t\t\t\t\t'% Welcome to Underleaf!\\n% Select a file from the file tree to start editing\\n\\n\\\\documentclass{article}\\n\\\\usepackage[utf8]{inputenc}\\n\\\\usepackage[T1]{fontenc}\\n\\\\usepackage{amsmath}\\n\\\\usepackage{amsfonts}\\n\\\\usepackage{amssymb}\\n\\\\usepackage{graphicx}\\n\\n\\\\title{Your Document Title}\\n\\\\author{Your Name}\\n\\\\date{\\\\today}\\n\\n\\\\begin{document}\\n\\n\\\\maketitle\\n\\n\\\\section{Introduction}\\n\\nYour content here...\\n\\n\\\\end{document}',\n\t\t\t\tlanguage: 'latex',\n\t\t\t\ttheme: 'vs-dark',\n\t\t\t\tfontSize: 14,\n\t\t\t\tfontFamily: 'JetBrains Mono, Consolas, Monaco, monospace',\n\t\t\t\twordWrap: 'on',\n\t\t\t\tautomaticLayout: true,\n\t\t\t\tminimap: { enabled: false },\n\t\t\t\tscrollBeyondLastLine: false,\n\t\t\t\trenderLineHighlight: 'line',\n\t\t\t\tlineNumbers: 'on',\n\t\t\t\tfolding: true,\n\t\t\t\tbracketMatching: 'always',\n\t\t\t\tautoIndent: 'full',\n\t\t\t\ttabSize: 2,\n\t\t\t\tinsertSpaces: true\n\t\t\t});\n\n\t\t\t// Auto-save on content change\n\t\t\tmonacoEditor.onDidChangeModelContent(() => {\n\t\t\t\tunsavedChanges = true;\n\n\t\t\t\tif (autoSaveTimeout) {\n\t\t\t\t\tclearTimeout(autoSaveTimeout);\n\t\t\t\t}\n\n\t\t\t\tautoSaveTimeout = setTimeout(() => {\n\t\t\t\t\tif (currentFilePath && unsavedChanges) {\n\t\t\t\t\t\thandleSaveFile();\n\t\t\t\t\t}\n\t\t\t\t}, 2000); // Auto-save after 2 seconds of inactivity\n\t\t\t});\n\n\t\t\t// Add LaTeX-specific keybindings\n\t\t\tmonacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, () => {\n\t\t\t\thandleSaveFile();\n\t\t\t});\n\n\t\t\t// Ensure editor layout is correct after initialization\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (monacoEditor) {\n\t\t\t\t\tmonacoEditor.layout();\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to initialize Monaco Editor:', error);\n\t\t}\n\t}\n\n\tasync function handleFileSelect(filePath: string) {\n\t\tif (!currentRepoName) return;\n\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tconst response = await apiClient.getFileContent(currentRepoName, filePath, userId);\n\n\t\t\tif (monacoEditor) {\n\t\t\t\tmonacoEditor.setValue(response.content);\n\t\t\t\tcurrentFilePath = filePath;\n\t\t\t\tunsavedChanges = false;\n\t\t\t\tcompileError = null;\n\t\t\t\tcompileSuccess = false;\n\n\t\t\t\t// Set language based on file extension\n\t\t\t\tconst ext = filePath.split('.').pop()?.toLowerCase();\n\t\t\t\tconst language =\n\t\t\t\t\text === 'tex'\n\t\t\t\t\t\t? 'latex'\n\t\t\t\t\t\t: ext === 'bib'\n\t\t\t\t\t\t\t? 'bibtex'\n\t\t\t\t\t\t\t: ext === 'md'\n\t\t\t\t\t\t\t\t? 'markdown'\n\t\t\t\t\t\t\t\t: ext === 'json'\n\t\t\t\t\t\t\t\t\t? 'json'\n\t\t\t\t\t\t\t\t\t: 'plaintext';\n\n\t\t\t\tmonaco.editor.setModelLanguage(monacoEditor.getModel(), language);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tcompileError = err instanceof Error ? err.message : 'Failed to load file';\n\t\t}\n\t}\n\n\tasync function handleSaveFile() {\n\t\tif (!currentRepoName || !currentFilePath || !monacoEditor) return;\n\n\t\ttry {\n\t\t\tconst content = monacoEditor.getValue();\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tawait apiClient.saveFile(currentRepoName, currentFilePath, content, userId);\n\t\t\tunsavedChanges = false;\n\n\t\t\tif (autoSaveTimeout) {\n\t\t\t\tclearTimeout(autoSaveTimeout);\n\t\t\t\tautoSaveTimeout = null;\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error('Failed to save file:', err);\n\t\t}\n\t}\n\n\tasync function handleCompile() {\n\t\tif (!currentRepoName) return;\n\n\t\tisCompiling = true;\n\t\tcompileError = null;\n\t\tcompileSuccess = false;\n\n\t\t// Save current file before compiling\n\t\tif (currentFilePath && unsavedChanges) {\n\t\t\tawait handleSaveFile();\n\t\t}\n\n\t\ttry {\n\t\t\tconst texFile = currentFilePath?.endsWith('.tex') ? currentFilePath : 'main.tex';\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tconst result = await apiClient.compileRepo(currentRepoName, userId, texFile);\n\t\t\tcompileSuccess = true;\n\n\t\t\tif (result.pdfUrl) {\n\t\t\t\t// Use relative URL since we're proxying through Vite\n\t\t\t\tpdfUrl = result.pdfUrl;\n\t\t\t}\n\n\t\t\tconsole.log('Compilation successful:', result);\n\t\t} catch (err) {\n\t\t\tcompileError = err instanceof Error ? err.message : 'Compilation failed';\n\t\t} finally {\n\t\t\tisCompiling = false;\n\t\t}\n\t}\n\n\tfunction handleGoHome() {\n\t\tif (currentRepoName) {\n\t\t\tlocalStorage.removeItem('currentRepo');\n\t\t}\n\t\tgoto('/');\n\t}\n\n\tasync function handleRefreshGitStatus() {\n\t\tif (!currentRepoName) return;\n\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tgitStatus = await apiClient.getGitStatus(currentRepoName, userId);\n\t\t\tgitError = null;\n\t\t} catch (err) {\n\t\t\tgitError = err instanceof Error ? err.message : 'Failed to get Git status';\n\t\t}\n\t}\n\n\tasync function handleCommit() {\n\t\tif (!currentRepoName || !commitMessage.trim()) return;\n\n\t\tisCommitting = true;\n\t\tcommitSuccess = false;\n\t\tgitError = null;\n\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tawait apiClient.commitChanges(currentRepoName, commitMessage.trim(), userId);\n\t\t\tcommitSuccess = true;\n\t\t\tcommitMessage = '';\n\n\t\t\t// Refresh Git status after committing\n\t\t\tawait handleRefreshGitStatus();\n\n\t\t\t// Clear success message after 3 seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tcommitSuccess = false;\n\t\t\t}, 3000);\n\t\t} catch (err) {\n\t\t\tgitError = err instanceof Error ? err.message : 'Failed to commit changes';\n\t\t} finally {\n\t\t\tisCommitting = false;\n\t\t}\n\t}\n\n\tasync function handlePush() {\n\t\tif (!currentRepoName) return;\n\n\t\tisPushing = true;\n\t\tpushSuccess = false;\n\t\tgitError = null;\n\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tawait apiClient.pushChanges(currentRepoName, userId);\n\t\t\tpushSuccess = true;\n\n\t\t\t// Clear success message after 3 seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tpushSuccess = false;\n\t\t\t}, 3000);\n\t\t} catch (err) {\n\t\t\tgitError = err instanceof Error ? err.message : 'Failed to push changes';\n\t\t} finally {\n\t\t\tisPushing = false;\n\t\t}\n\t}\n\n\tasync function handleFetch() {\n\t\tif (!currentRepoName) return;\n\n\t\tisFetching = true;\n\t\tfetchSuccess = false;\n\t\tgitError = null;\n\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tawait apiClient.fetchChanges(currentRepoName, userId);\n\t\t\tfetchSuccess = true;\n\n\t\t\t// Refresh Git status after fetching\n\t\t\tawait handleRefreshGitStatus();\n\n\t\t\t// Clear success message after 3 seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tfetchSuccess = false;\n\t\t\t}, 3000);\n\t\t} catch (err) {\n\t\t\tgitError = err instanceof Error ? err.message : 'Failed to fetch changes';\n\t\t} finally {\n\t\t\tisFetching = false;\n\t\t}\n\t}\n\n\tasync function handlePull() {\n\t\tif (!currentRepoName) return;\n\n\t\tisPulling = true;\n\t\tpullSuccess = false;\n\t\tgitError = null;\n\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tawait apiClient.pullChanges(currentRepoName, userId);\n\t\t\tpullSuccess = true;\n\n\t\t\t// Refresh Git status after pulling\n\t\t\tawait handleRefreshGitStatus();\n\t\t\t// Note: File tree will be updated automatically due to reactive statements\n\n\t\t\t// Clear success message after 3 seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tpullSuccess = false;\n\t\t\t}, 3000);\n\t\t} catch (err) {\n\t\t\tgitError = err instanceof Error ? err.message : 'Failed to pull changes';\n\t\t} finally {\n\t\t\tisPulling = false;\n\t\t}\n\t}\n\n\tfunction getFileNameFromPath(path: string | null): string {\n\t\tif (!path) return 'Untitled';\n\t\treturn path.split('/').pop() || path;\n\t}\n\n\t// AI Chat functions\n\tasync function handleAiChatMessage(event: CustomEvent<string>) {\n\t\tconst userMessage = event.detail;\n\n\t\tif (!currentRepoName) {\n\t\t\tconsole.error('No repository selected for AI chat');\n\t\t\treturn;\n\t\t}\n\n\t\t// Add user message\n\t\taiChatMessages = [\n\t\t\t...aiChatMessages,\n\t\t\t{\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: userMessage,\n\t\t\t\ttimestamp: new Date()\n\t\t\t}\n\t\t];\n\n\t\t// Set loading state\n\t\taiChatLoading = true;\n\t\tlet currentAssistantMessageIndex = -1;\n\n\t\ttry {\n\t\t\t// Call Claude AI API with streaming\n\t\t\tconst userId = getCurrentUserId();\n\t\t\t\n\t\t\tawait apiClient.sendClaudeMessageStreaming(\n\t\t\t\tcurrentRepoName, \n\t\t\t\tuserMessage, \n\t\t\t\t(chunk: string) => {\n\t\t\t\t\t// Check if chunk contains tool call data\n\t\t\t\t\tconst toolCallMatch = chunk.match(/__TOOL_CALL_START__(.+?)__TOOL_CALL_END__/);\n\t\t\t\t\tif (toolCallMatch) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst toolCallData = JSON.parse(toolCallMatch[1]);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Process edit diff if this is an Edit tool call\n\t\t\t\t\t\t\tconst editDiff = processEditToolCall(toolCallData);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// If this is the first chunk or we need a new message, create one\n\t\t\t\t\t\t\tif (currentAssistantMessageIndex === -1) {\n\t\t\t\t\t\t\t\taiChatMessages = [\n\t\t\t\t\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\t\t\t\t\tcontent: '',\n\t\t\t\t\t\t\t\t\t\ttimestamp: new Date(),\n\t\t\t\t\t\t\t\t\t\tcontentBlocks: [{\n\t\t\t\t\t\t\t\t\t\t\ttype: 'tool_call',\n\t\t\t\t\t\t\t\t\t\t\ttoolCall: {\n\t\t\t\t\t\t\t\t\t\t\t\tname: toolCallData.name,\n\t\t\t\t\t\t\t\t\t\t\t\tid: toolCallData.id,\n\t\t\t\t\t\t\t\t\t\t\t\targuments: toolCallData.arguments,\n\t\t\t\t\t\t\t\t\t\t\t\texpanded: false,\n\t\t\t\t\t\t\t\t\t\t\t\teditDiff\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\tcurrentAssistantMessageIndex = aiChatMessages.length - 1;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Add tool call to existing message in order\n\t\t\t\t\t\t\t\taiChatMessages = aiChatMessages.map((msg, index) => {\n\t\t\t\t\t\t\t\t\tif (index === currentAssistantMessageIndex) {\n\t\t\t\t\t\t\t\t\t\tconst existingBlocks = msg.contentBlocks || [];\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\t...msg,\n\t\t\t\t\t\t\t\t\t\t\tcontentBlocks: [...existingBlocks, {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'tool_call',\n\t\t\t\t\t\t\t\t\t\t\t\ttoolCall: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: toolCallData.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: toolCallData.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\targuments: toolCallData.arguments,\n\t\t\t\t\t\t\t\t\t\t\t\t\texpanded: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\teditDiff\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn msg;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Failed to parse tool call data:', error);\n\t\t\t\t\t\t\t// Fall back to treating as regular text\n\t\t\t\t\t\t\tprocessRegularChunk(chunk);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Regular text chunk\n\t\t\t\t\t\tprocessRegularChunk(chunk);\n\t\t\t\t\t}\n\n\t\t\t\t\tfunction processRegularChunk(textChunk: string) {\n\t\t\t\t\t\t// If this is the first chunk or we need a new message, create one\n\t\t\t\t\t\tif (currentAssistantMessageIndex === -1) {\n\t\t\t\t\t\t\t// Add new assistant message\n\t\t\t\t\t\t\taiChatMessages = [\n\t\t\t\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\t\t\t\tcontent: textChunk,\n\t\t\t\t\t\t\t\t\ttimestamp: new Date(),\n\t\t\t\t\t\t\t\t\tcontentBlocks: [{\n\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\tcontent: textChunk\n\t\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\tcurrentAssistantMessageIndex = aiChatMessages.length - 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Update the current assistant message content as chunks arrive\n\t\t\t\t\t\t\taiChatMessages = aiChatMessages.map((msg, index) => {\n\t\t\t\t\t\t\t\tif (index === currentAssistantMessageIndex) {\n\t\t\t\t\t\t\t\t\tconst existingBlocks = msg.contentBlocks || [];\n\t\t\t\t\t\t\t\t\tconst lastBlock = existingBlocks[existingBlocks.length - 1];\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// If the last block is text, append to it; otherwise create new text block\n\t\t\t\t\t\t\t\t\tif (lastBlock && lastBlock.type === 'text') {\n\t\t\t\t\t\t\t\t\t\tconst updatedBlocks = [...existingBlocks];\n\t\t\t\t\t\t\t\t\t\tupdatedBlocks[updatedBlocks.length - 1] = {\n\t\t\t\t\t\t\t\t\t\t\t...lastBlock,\n\t\t\t\t\t\t\t\t\t\t\tcontent: (lastBlock.content || '') + textChunk\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\t...msg,\n\t\t\t\t\t\t\t\t\t\t\tcontent: msg.content + textChunk,\n\t\t\t\t\t\t\t\t\t\t\tcontentBlocks: updatedBlocks\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\t...msg,\n\t\t\t\t\t\t\t\t\t\t\tcontent: msg.content + textChunk,\n\t\t\t\t\t\t\t\t\t\t\tcontentBlocks: [...existingBlocks, {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\t\t\tcontent: textChunk\n\t\t\t\t\t\t\t\t\t\t\t}]\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn msg;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tuserId\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tconsole.error('Claude AI error:', error);\n\n\t\t\t// Add error message\n\t\t\taiChatMessages = [\n\t\t\t\t...aiChatMessages,\n\t\t\t\t{\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: `Sorry, I encountered an error: ${error instanceof Error ? error.message : 'Unknown error'}. Please try again.`,\n\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t}\n\t\t\t];\n\t\t} finally {\n\t\t\taiChatLoading = false;\n\t\t}\n\t}\n\n\tasync function handleClearAiChat() {\n\t\taiChatMessages = [];\n\t\t\n\t\t// Clear Claude session for multi-turn conversations\n\t\tif (currentRepoName) {\n\t\t\ttry {\n\t\t\t\tconst userId = getCurrentUserId();\n\t\t\t\tconst result = await apiClient.clearClaudeSession(currentRepoName, userId);\n\t\t\t\tconsole.log('🗑️ Cleared Claude session:', result.message);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.warn('Failed to clear Claude session:', error);\n\t\t\t\t// Don't show error to user as this is not critical\n\t\t\t}\n\t\t}\n\t}\n\n\t// Handle applying edit diffs to the editor\n\tasync function handleApplyEdit(event: CustomEvent<{ messageIndex: number; blockIndex: number; editDiff: any }>) {\n\t\tconst { editDiff } = event.detail;\n\t\t\n\t\tif (!monacoEditor || !editDiff) {\n\t\t\tconsole.error('Monaco editor not available or invalid edit diff');\n\t\t\treturn;\n\t\t}\n\t\t\n\t\ttry {\n\t\t\t// Get current editor content\n\t\t\tconst currentContent = monacoEditor.getValue();\n\t\t\t\n\t\t\t// Find and replace the old string with the new string\n\t\t\tconst newContent = currentContent.replace(editDiff.oldString, editDiff.newString);\n\t\t\t\n\t\t\t// Apply the change to the editor\n\t\t\tmonacoEditor.setValue(newContent);\n\t\t\t\n\t\t\t// Mark as unsaved\n\t\t\tunsavedChanges = true;\n\t\t\t\n\t\t\tconsole.log('Edit applied successfully');\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to apply edit:', error);\n\t\t}\n\t}\n\n\t// Handle rejecting edit diffs\n\tfunction handleRejectEdit(event: CustomEvent<{ messageIndex: number; blockIndex: number }>) {\n\t\tconst { messageIndex, blockIndex } = event.detail;\n\t\tconsole.log(`Edit rejected for message ${messageIndex}, block ${blockIndex}`);\n\t\t// No action needed for rejection, just logged for debugging\n\t}\n\n\t// Claude Code Modal functions\n\tfunction handleClaudeCodeRequired(event: CustomEvent<{ authUrl: string; sessionId: string }>) {\n\t\tclaudeAuthUrl = event.detail.authUrl;\n\t\tclaudeSessionId = event.detail.sessionId;\n\t\tshowClaudeCodeModal = true;\n\t}\n\n\tasync function handleClaudeCodeSubmit(\n\t\tevent: CustomEvent<{ verificationCode: string; sessionId: string }>\n\t) {\n\t\tconst { verificationCode, sessionId } = event.detail;\n\n\t\tif (!currentRepoName) {\n\t\t\tconsole.error('No repository selected for Claude code verification');\n\t\t\tclaudeCodeSubmitting = false;\n\t\t\treturn;\n\t\t}\n\n\t\tclaudeCodeSubmitting = true;\n\t\tconsole.log('🔐 Submitting Claude verification code:', verificationCode);\n\n\t\ttry {\n\t\t\tconst userId = getCurrentUserId();\n\t\t\tconst result = await apiClient.verifyClaudeCode(\n\t\t\t\tcurrentRepoName,\n\t\t\t\tverificationCode,\n\t\t\t\tsessionId,\n\t\t\t\tuserId\n\t\t\t);\n\n\t\t\tconsole.log('🔐 Claude verification result:', result);\n\n\t\t\t\t\tif (result.configured) {\n\t\t\t// Success - close modal and show success message\n\t\t\tshowClaudeCodeModal = false;\n\t\t\t\n\t\t\t// Stop any ongoing auth status checking\n\t\t\tif (authStatusCheckInterval) {\n\t\t\t\tclearInterval(authStatusCheckInterval);\n\t\t\t\tauthStatusCheckInterval = null;\n\t\t\t}\n\n\t\t\t// Add success message to AI chat\n\t\t\taiChatMessages = [\n\t\t\t\t...aiChatMessages,\n\t\t\t\t{\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent:\n\t\t\t\t\t\t'🎉 Claude AI has been successfully authenticated! You can now use AI assistance for your LaTeX projects.',\n\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t}\n\t\t\t];\n\t\t\t} else if (result.error) {\n\t\t\t\t// Error - show in AI chat and close modal to restart process\n\t\t\t\tshowClaudeCodeModal = false;\n\t\t\t\taiChatMessages = [\n\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\tcontent: `❌ Authentication failed: ${result.error}. Please try the setup process again.`,\n\t\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t} else {\n\t\t\t\t// Still processing - show interim message and keep modal open\n\t\t\t\taiChatMessages = [\n\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\tcontent: `⏳ Verification code submitted successfully. Claude is processing your authentication - this may take up to 60 seconds...`,\n\t\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Claude code verification error:', error);\n\n\t\t\tconst errorMessage = error instanceof Error ? error.message : 'Unknown error';\n\t\t\t\n\t\t\t// For timeout or long-running authentication, don't show error - show progress message\n\t\t\tif (errorMessage.includes('timeout') || errorMessage.includes('Authentication timeout') || errorMessage.includes('no response')) {\n\t\t\t\t// Keep modal open and show waiting message - authentication may still be processing\n\t\t\t\taiChatMessages = [\n\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\tcontent: `⏳ Authentication is processing and may take up to 2 minutes. Please wait while we verify your code...`,\n\t\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t// Start periodic check for authentication completion\n\t\t\t\tstartAuthStatusCheck();\n\t\t\t} else {\n\t\t\t\t// Close modal and show error message for actual errors\n\t\t\t\tshowClaudeCodeModal = false;\n\t\t\t\taiChatMessages = [\n\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\tcontent: `❌ Verification failed: ${errorMessage}. Please try the setup process again.`,\n\t\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\t\t} finally {\n\t\t\tclaudeCodeSubmitting = false;\n\t\t}\n\t}\n\n\tfunction handleClaudeCodeCancel() {\n\t\tshowClaudeCodeModal = false;\n\t\tclaudeAuthUrl = '';\n\t\tclaudeSessionId = '';\n\t\t\n\t\t// Stop any ongoing auth status checking\n\t\tif (authStatusCheckInterval) {\n\t\t\tclearInterval(authStatusCheckInterval);\n\t\t\tauthStatusCheckInterval = null;\n\t\t}\n\t}\n\n\tlet authStatusCheckInterval: NodeJS.Timeout | null = null;\n\n\tfunction startAuthStatusCheck() {\n\t\t// Clear any existing interval\n\t\tif (authStatusCheckInterval) {\n\t\t\tclearInterval(authStatusCheckInterval);\n\t\t}\n\n\t\tlet checkCount = 0;\n\t\tconst maxChecks = 15; // Check for 2.5 more minutes (10s * 15 = 150s)\n\n\t\tauthStatusCheckInterval = setInterval(async () => {\n\t\t\tcheckCount++;\n\t\t\tconsole.log(`Auth status check ${checkCount}/${maxChecks}: checking authentication status...`);\n\n\t\t\tif (checkCount > maxChecks || !currentRepoName) {\n\t\t\t\tclearInterval(authStatusCheckInterval!);\n\t\t\t\tauthStatusCheckInterval = null;\n\n\t\t\t\t// Only show timeout if modal is still open (authentication hasn't completed)\n\t\t\t\tif (showClaudeCodeModal) {\n\t\t\t\t\tshowClaudeCodeModal = false;\n\t\t\t\t\taiChatMessages = [\n\t\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\t\tcontent: `❌ Authentication timed out after waiting ${Math.floor(maxChecks * 10 / 60)} minutes. Please try the setup process again.`,\n\t\t\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Check if Claude is now configured by trying to send a simple status message\n\t\t\t\tconst userId = getCurrentUserId();\n\t\t\t\tconst result = await apiClient.sendClaudeMessage(currentRepoName, '/status', userId);\n\n\t\t\t\tif (result && result.response && !result.response.includes('not configured') && !result.response.includes('not authenticated')) {\n\t\t\t\t\t// Authentication successful!\n\t\t\t\t\tclearInterval(authStatusCheckInterval!);\n\t\t\t\t\tauthStatusCheckInterval = null;\n\t\t\t\t\t\n\t\t\t\t\t// Only close modal and show success if not already handled\n\t\t\t\t\tif (showClaudeCodeModal) {\n\t\t\t\t\t\tshowClaudeCodeModal = false;\n\t\t\t\t\t\taiChatMessages = [\n\t\t\t\t\t\t\t...aiChatMessages,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trole: 'assistant',\n\t\t\t\t\t\t\t\tcontent: '🎉 Claude AI authentication completed successfully! You can now use AI assistance.',\n\t\t\t\t\t\t\t\ttimestamp: new Date()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log('✅ Authentication check successful - Claude is now configured');\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Still not ready, continue checking\n\t\t\t\tconsole.log(`Auth status check ${checkCount}/${maxChecks}: still waiting...`);\n\t\t\t}\n\t\t}, 10000); // Check every 10 seconds\n\t}\n\n\t// Layout functions\n\tfunction setLayoutMode(mode: 'both' | 'editor' | 'pdf') {\n\t\tconst previousMode = layoutMode;\n\t\tlayoutMode = mode;\n\n\t\t// If switching from PDF-only to a mode that includes the editor, recreate the editor\n\t\tif (previousMode === 'pdf' && (mode === 'editor' || mode === 'both')) {\n\t\t\tconsole.log('Switching from PDF to editor mode, recreating editor...');\n\n\t\t\t// Store current content\n\t\t\tconst currentContent = monacoEditor ? monacoEditor.getValue() : '';\n\t\t\tconst currentLanguage = monacoEditor ? monacoEditor.getModel()?.getLanguageId() : 'latex';\n\n\t\t\t// Dispose and recreate the editor\n\t\t\tif (monacoEditor) {\n\t\t\t\tmonacoEditor.dispose();\n\t\t\t\tmonacoEditor = null;\n\t\t\t}\n\n\t\t\t// Wait for DOM to update, then recreate\n\t\t\tsetTimeout(async () => {\n\t\t\t\tif (editorContainer && monaco) {\n\t\t\t\t\tconsole.log('Recreating Monaco editor...');\n\n\t\t\t\t\tmonacoEditor = monaco.editor.create(editorContainer, {\n\t\t\t\t\t\tvalue: currentContent,\n\t\t\t\t\t\tlanguage: currentLanguage,\n\t\t\t\t\t\ttheme: 'vs-dark',\n\t\t\t\t\t\tfontSize: 14,\n\t\t\t\t\t\tfontFamily: 'JetBrains Mono, Consolas, Monaco, monospace',\n\t\t\t\t\t\twordWrap: 'on',\n\t\t\t\t\t\tautomaticLayout: true,\n\t\t\t\t\t\tminimap: { enabled: false },\n\t\t\t\t\t\tscrollBeyondLastLine: false,\n\t\t\t\t\t\trenderLineHighlight: 'line',\n\t\t\t\t\t\tlineNumbers: 'on',\n\t\t\t\t\t\tfolding: true,\n\t\t\t\t\t\tbracketMatching: 'always',\n\t\t\t\t\t\tautoIndent: 'full',\n\t\t\t\t\t\ttabSize: 2,\n\t\t\t\t\t\tinsertSpaces: true\n\t\t\t\t\t});\n\n\t\t\t\t\t// Re-add event listeners\n\t\t\t\t\tmonacoEditor.onDidChangeModelContent(() => {\n\t\t\t\t\t\tunsavedChanges = true;\n\n\t\t\t\t\t\tif (autoSaveTimeout) {\n\t\t\t\t\t\t\tclearTimeout(autoSaveTimeout);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tautoSaveTimeout = setTimeout(() => {\n\t\t\t\t\t\t\tif (currentFilePath && unsavedChanges) {\n\t\t\t\t\t\t\t\thandleSaveFile();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t});\n\n\t\t\t\t\tmonacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, () => {\n\t\t\t\t\t\thandleSaveFile();\n\t\t\t\t\t});\n\n\t\t\t\t\tconsole.log('Editor recreated successfully');\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t} else {\n\t\t\t// Normal layout trigger for other mode changes\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (monacoEditor) {\n\t\t\t\t\tmonacoEditor.layout();\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t}\n\t}\n\n\t// Performance-optimized resize functions with GPU acceleration\n\tlet rafId: number | null = null;\n\tlet pendingResizeEvent: MouseEvent | null = null;\n\n\tfunction startResize(\n\t\tpanel: 'filetree' | 'editor-pdf' | 'git-split' | 'ai-chat',\n\t\tevent: MouseEvent\n\t) {\n\t\tisResizing = true;\n\t\tresizingPanel = panel;\n\t\tevent.preventDefault();\n\n\t\t// Add performance optimization classes and prevent iframe event capture\n\t\tif (panel === 'editor-pdf') {\n\t\t\tconst mainArea = document.querySelector('.main-content-area') as HTMLElement;\n\t\t\tif (mainArea) {\n\t\t\t\tmainArea.style.willChange = 'transform';\n\t\t\t}\n\n\t\t\t// Prevent PDF iframe from capturing mouse events during resize\n\t\t\tconst pdfIframes = document.querySelectorAll('iframe');\n\t\t\tpdfIframes.forEach((iframe) => {\n\t\t\t\tiframe.style.pointerEvents = 'none';\n\t\t\t});\n\n\t\t\t// Add transparent overlay to ensure mouse events are captured\n\t\t\tconst overlay = document.createElement('div');\n\t\t\toverlay.id = 'resize-overlay';\n\t\t\toverlay.style.cssText = `\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\twidth: 100vw;\n\t\t\t\theight: 100vh;\n\t\t\t\tbackground: transparent;\n\t\t\t\tz-index: 9999;\n\t\t\t\tcursor: col-resize;\n\t\t\t\tpointer-events: auto;\n\t\t\t`;\n\t\t\tdocument.body.appendChild(overlay);\n\n\t\t\t// Add body class for consistent cursor styling\n\t\t\tdocument.body.classList.add('resizing-editor-pdf');\n\t\t}\n\n\t\tdocument.addEventListener('mousemove', handleResizeThrottled);\n\t\tdocument.addEventListener('mouseup', stopResize);\n\t}\n\n\tfunction handleResizeThrottled(event: MouseEvent) {\n\t\tif (!isResizing || !resizingPanel) return;\n\n\t\tpendingResizeEvent = event;\n\n\t\t// Use immediate update for first event, then throttle subsequent ones\n\t\tif (rafId === null) {\n\t\t\trafId = requestAnimationFrame(() => {\n\t\t\t\tif (pendingResizeEvent) {\n\t\t\t\t\thandleResize(pendingResizeEvent);\n\t\t\t\t\tpendingResizeEvent = null;\n\t\t\t\t}\n\t\t\t\trafId = null;\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction handleResize(event: MouseEvent) {\n\t\tif (!isResizing || !resizingPanel) return;\n\n\t\tconst newX = event.clientX;\n\t\tconst newY = event.clientY;\n\n\t\tif (resizingPanel === 'filetree') {\n\t\t\tconst minWidth = 200;\n\t\t\tconst maxWidth = 500;\n\t\t\tfileTreeWidth = Math.min(Math.max(newX, minWidth), maxWidth);\n\t\t} else if (resizingPanel === 'editor-pdf') {\n\t\t\t// Calculate percentage based on the main content area\n\t\t\tconst mainArea = document.querySelector('.main-content-area') as HTMLElement;\n\t\t\tif (mainArea) {\n\t\t\t\tconst rect = mainArea.getBoundingClientRect();\n\n\t\t\t\t// Ensure we have valid dimensions\n\t\t\t\tif (rect.width <= 0) return;\n\n\t\t\t\tconst relativeX = newX - rect.left; // Allow negative values for leftward dragging\n\t\t\t\tconst percentage = (relativeX / rect.width) * 100; // Allow negative percentages\n\t\t\t\tconst newWidth = Math.min(Math.max(percentage, 20), 80); // 20% to 80% range\n\n\t\t\t\t// Always update to allow smooth bidirectional resizing\n\t\t\t\teditorWidth = newWidth;\n\t\t\t}\n\t\t} else if (resizingPanel === 'git-split') {\n\t\t\t// Calculate percentage based on the sidebar height\n\t\t\tconst sidebar = document.querySelector('aside') as HTMLElement;\n\t\t\tif (sidebar) {\n\t\t\t\tconst rect = sidebar.getBoundingClientRect();\n\t\t\t\tconst relativeY = newY - rect.top;\n\t\t\t\tconst percentage = ((rect.height - relativeY) / rect.height) * 100;\n\t\t\t\tconst newHeight = Math.min(Math.max(percentage, 20), 70); // 20% to 70% range\n\n\t\t\t\t// Always update for smooth bidirectional resizing\n\t\t\t\tgitPanelHeight = newHeight;\n\t\t\t}\n\t\t} else if (resizingPanel === 'ai-chat') {\n\t\t\t// Calculate new height for AI chat panel within PDF column\n\t\t\tconst pdfColumn = document.querySelector(\n\t\t\t\t'.main-content-area > div:last-child'\n\t\t\t) as HTMLElement;\n\t\t\tif (pdfColumn) {\n\t\t\t\tconst rect = pdfColumn.getBoundingClientRect();\n\t\t\t\tconst relativeY = newY - rect.top;\n\t\t\t\tconst availableHeight = rect.height;\n\t\t\t\tconst newHeight = availableHeight - relativeY;\n\t\t\t\taiChatHeight = Math.min(Math.max(newHeight, 200), 800); // 200px to 800px range\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction stopResize() {\n\t\tconst wasEditorPdfResize = resizingPanel === 'editor-pdf';\n\t\tisResizing = false;\n\t\tresizingPanel = null;\n\n\t\t// Clean up RAF and performance optimizations\n\t\tif (rafId !== null) {\n\t\t\tcancelAnimationFrame(rafId);\n\t\t\trafId = null;\n\t\t}\n\t\tpendingResizeEvent = null;\n\n\t\t// Remove performance optimization classes and restore iframe events\n\t\tconst mainArea = document.querySelector('.main-content-area') as HTMLElement;\n\t\tif (mainArea) {\n\t\t\tmainArea.style.willChange = 'auto';\n\t\t}\n\n\t\t// Restore PDF iframe pointer events\n\t\tconst pdfIframes = document.querySelectorAll('iframe');\n\t\tpdfIframes.forEach((iframe) => {\n\t\t\tiframe.style.pointerEvents = 'auto';\n\t\t});\n\n\t\t// Remove transparent overlay\n\t\tconst overlay = document.getElementById('resize-overlay');\n\t\tif (overlay) {\n\t\t\toverlay.remove();\n\t\t}\n\n\t\t// Remove body class\n\t\tdocument.body.classList.remove('resizing-editor-pdf');\n\n\t\t// Debounce Monaco editor layout call for better performance\n\t\tif (monacoEditor && wasEditorPdfResize) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (monacoEditor) {\n\t\t\t\t\tmonacoEditor.layout();\n\t\t\t\t}\n\t\t\t}, 100); // Increased debounce for better performance\n\t\t}\n\n\t\tdocument.removeEventListener('mousemove', handleResizeThrottled);\n\t\tdocument.removeEventListener('mouseup', stopResize);\n\t}\n</script>\n\n<svelte:head>\n\t<title>Editor - Underleaf</title>\n</svelte:head>\n\n<div class=\"h-screen flex flex-col bg-dark-900\">\n\t<!-- Header -->\n\t<header class=\"bg-dark-800 border-b border-gray-700 px-6 py-4 flex items-center justify-between\">\n\t\t<div class=\"flex items-center space-x-4\">\n\t\t\t<button\n\t\t\t\ton:click={handleGoHome}\n\t\t\t\tclass=\"text-gray-300 hover:text-white transition-colors\"\n\t\t\t\taria-label=\"Go back to home\"\n\t\t\t>\n\t\t\t\t<svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\td=\"M10 19l-7-7m0 0l7-7m-7 7h18\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t\t<div>\n\t\t\t\t<h1 class=\"text-xl font-semibold text-white\">Underleaf Editor</h1>\n\t\t\t\t{#if currentRepoName}\n\t\t\t\t\t<p class=\"text-sm text-gray-400\">{currentRepoName}</p>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex items-center space-x-4\">\n\t\t\t<!-- Layout Toggle Buttons -->\n\t\t\t<div class=\"flex items-center space-x-1 bg-dark-700 rounded p-1\">\n\t\t\t\t<button\n\t\t\t\t\ton:click={() => setLayoutMode('editor')}\n\t\t\t\t\tclass=\"px-3 py-1.5 text-xs rounded transition-colors {layoutMode === 'editor'\n\t\t\t\t\t\t? 'bg-blue-600 text-white'\n\t\t\t\t\t\t: 'text-gray-400 hover:text-white hover:bg-gray-600'}\"\n\t\t\t\t\ttitle=\"Editor only\"\n\t\t\t\t>\n\t\t\t\t\tEditor\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\ton:click={() => setLayoutMode('both')}\n\t\t\t\t\tclass=\"px-3 py-1.5 text-xs rounded transition-colors {layoutMode === 'both'\n\t\t\t\t\t\t? 'bg-blue-600 text-white'\n\t\t\t\t\t\t: 'text-gray-400 hover:text-white hover:bg-gray-600'}\"\n\t\t\t\t\ttitle=\"Side by side\"\n\t\t\t\t>\n\t\t\t\t\tBoth\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\ton:click={() => setLayoutMode('pdf')}\n\t\t\t\t\tclass=\"px-3 py-1.5 text-xs rounded transition-colors {layoutMode === 'pdf'\n\t\t\t\t\t\t? 'bg-blue-600 text-white'\n\t\t\t\t\t\t: 'text-gray-400 hover:text-white hover:bg-gray-600'}\"\n\t\t\t\t\ttitle=\"PDF only\"\n\t\t\t\t>\n\t\t\t\t\tPDF\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<!-- AI Chat Toggle -->\n\t\t\t<button\n\t\t\t\ton:click={() => (showAiChat = !showAiChat)}\n\t\t\t\tclass=\"text-gray-400 hover:text-white transition-colors p-2 rounded {showAiChat\n\t\t\t\t\t? 'bg-blue-600 text-white'\n\t\t\t\t\t: ''}\"\n\t\t\t\ttitle=\"Toggle AI Chat\"\n\t\t\t\taria-label=\"Toggle AI Chat\"\n\t\t\t>\n\t\t\t\t<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\td=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\n\t\t\t{#if currentFilePath}\n\t\t\t\t<div class=\"text-sm text-gray-300 flex items-center space-x-2\">\n\t\t\t\t\t<span>📄</span>\n\t\t\t\t\t<span>{getFileNameFromPath(currentFilePath)}</span>\n\t\t\t\t\t{#if unsavedChanges}\n\t\t\t\t\t\t<span class=\"text-orange-400\" title=\"Unsaved changes\">●</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t{#if compileSuccess}\n\t\t\t\t<div class=\"text-green-400 text-sm flex items-center space-x-2\">\n\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<span>Compiled successfully</span>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t{#if currentFilePath}\n\t\t\t\t<button\n\t\t\t\t\ton:click={handleSaveFile}\n\t\t\t\t\tdisabled={!unsavedChanges}\n\t\t\t\t\tclass=\"text-gray-400 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\ttitle=\"Save file (Ctrl+S)\"\n\t\t\t\t\taria-label=\"Save file\"\n\t\t\t\t>\n\t\t\t\t\t<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\td=\"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t{/if}\n\n\t\t\t<button\n\t\t\t\ton:click={handleCompile}\n\t\t\t\tdisabled={isCompiling || !currentRepoName}\n\t\t\t\tclass=\"btn-primary px-6 py-2 text-sm disabled:opacity-50\"\n\t\t\t>\n\t\t\t\t{#if isCompiling}\n\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t<div class=\"loading-spinner w-4 h-4\"></div>\n\t\t\t\t\t\t<span>Compiling...</span>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\tCompile PDF\n\t\t\t\t{/if}\n\t\t\t</button>\n\t\t</div>\n\t</header>\n\n\t<!-- Main Editor Area -->\n\t<div class=\"flex-1 flex flex-col overflow-hidden main-content-wrapper\">\n\t\t<div class=\"flex-1 flex overflow-hidden\">\n\t\t\t<!-- File Tree + Git Sidebar -->\n\t\t\t<aside\n\t\t\t\tclass=\"bg-dark-800 border-r border-gray-700 relative flex flex-col\"\n\t\t\t\tstyle=\"width: {fileTreeWidth}px;\"\n\t\t\t>\n\t\t\t\t<!-- File Tree (Top Half) -->\n\t\t\t\t<div\n\t\t\t\t\tclass=\"overflow-y-auto border-b border-gray-700\"\n\t\t\t\t\tstyle=\"height: {100 - gitPanelHeight}%;\"\n\t\t\t\t>\n\t\t\t\t\t<FileTree\n\t\t\t\t\t\trepoName={currentRepoName}\n\t\t\t\t\t\tuserId={getCurrentUserId()}\n\t\t\t\t\t\tonFileSelect={handleFileSelect}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Git Panel Resize Handle -->\n\t\t\t\t<button\n\t\t\t\t\trole=\"separator\"\n\t\t\t\t\taria-label=\"Resize git panel\"\n\t\t\t\t\tclass=\"h-1 w-full cursor-row-resize hover:bg-blue-500 bg-gray-600 transition-colors border-0 p-0\"\n\t\t\t\t\ton:mousedown={(e) => startResize('git-split', e)}\n\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'ArrowUp' || e.key === 'ArrowDown') {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t// Keyboard resize logic can be added here\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t></button>\n\n\t\t\t\t<!-- Git Panel (Bottom Half) -->\n\t\t\t\t<div class=\"overflow-y-auto\" style=\"height: {gitPanelHeight}%;\">\n\t\t\t\t\t<div class=\"p-4\">\n\t\t\t\t\t\t<div class=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<h3 class=\"text-lg font-medium text-white\">Git Operations</h3>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ton:click={handleRefreshGitStatus}\n\t\t\t\t\t\t\t\tclass=\"text-gray-400 hover:text-white transition-colors\"\n\t\t\t\t\t\t\t\ttitle=\"Refresh Git status\"\n\t\t\t\t\t\t\t\taria-label=\"Refresh Git status\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\td=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if gitError}\n\t\t\t\t\t\t\t<div class=\"bg-red-500/10 border border-red-500/20 rounded p-3 mb-4\">\n\t\t\t\t\t\t\t\t<p class=\"text-red-300 text-sm\">{gitError}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if commitSuccess}\n\t\t\t\t\t\t\t<div class=\"bg-green-500/10 border border-green-500/20 rounded p-3 mb-4\">\n\t\t\t\t\t\t\t\t<p class=\"text-green-300 text-sm\">Changes committed successfully!</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if pushSuccess}\n\t\t\t\t\t\t\t<div class=\"bg-green-500/10 border border-green-500/20 rounded p-3 mb-4\">\n\t\t\t\t\t\t\t\t<p class=\"text-green-300 text-sm\">Changes pushed successfully!</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if fetchSuccess}\n\t\t\t\t\t\t\t<div class=\"bg-yellow-500/10 border border-yellow-500/20 rounded p-3 mb-4\">\n\t\t\t\t\t\t\t\t<p class=\"text-yellow-300 text-sm\">Changes fetched successfully!</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if pullSuccess}\n\t\t\t\t\t\t\t<div class=\"bg-purple-500/10 border border-purple-500/20 rounded p-3 mb-4\">\n\t\t\t\t\t\t\t\t<p class=\"text-purple-300 text-sm\">Changes pulled successfully!</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if gitStatus}\n\t\t\t\t\t\t\t<div class=\"mb-6\">\n\t\t\t\t\t\t\t\t<h4 class=\"text-sm font-medium text-gray-300 mb-2\">Repository Status</h4>\n\t\t\t\t\t\t\t\t<div class=\"mb-3 pb-2 border-b border-gray-600\">\n\t\t\t\t\t\t\t\t\t<p class=\"text-blue-400 text-sm\">\n\t\t\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4 inline mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414L2.586 7l3.707-3.707a1 1 0 011.414 0z\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\tBranch: {gitStatus.currentBranch}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t{#if gitStatus.tracking}\n\t\t\t\t\t\t\t\t\t\t<p class=\"text-gray-400 text-xs\">Tracking: {gitStatus.tracking}</p>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{#if gitStatus.clean}\n\t\t\t\t\t\t\t\t\t<p class=\"text-green-400 text-sm\">✓ Working directory clean</p>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<div class=\"space-y-2\">\n\t\t\t\t\t\t\t\t\t\t{#if gitStatus.modified.length > 0}\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-yellow-400 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tModified ({gitStatus.modified.length})\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{#each gitStatus.modified as file}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-gray-400 text-xs ml-2\">• {file}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{#if gitStatus.untracked.length > 0}\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-red-400 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tUntracked ({gitStatus.untracked.length})\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{#each gitStatus.untracked as file}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-gray-400 text-xs ml-2\">• {file}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{#if gitStatus.added.length > 0}\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-green-400 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tAdded ({gitStatus.added.length})\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{#each gitStatus.added as file}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-gray-400 text-xs ml-2\">• {file}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{#if gitStatus.deleted.length > 0}\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-red-400 text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tDeleted ({gitStatus.deleted.length})\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{#each gitStatus.deleted as file}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p class=\"text-gray-400 text-xs ml-2\">• {file}</p>\n\t\t\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<!-- Fetch and Pull buttons -->\n\t\t\t\t\t\t<div class=\"flex space-x-2 mb-4\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ton:click={handleFetch}\n\t\t\t\t\t\t\t\tdisabled={isFetching || !currentRepoName}\n\t\t\t\t\t\t\t\tclass=\"flex-1 bg-yellow-600 hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed text-white py-2 px-4 rounded text-sm transition-colors\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#if isFetching}\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center space-x-2\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"loading-spinner w-4 h-4\"></div>\n\t\t\t\t\t\t\t\t\t\t<span>Fetching...</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\tFetch\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ton:click={handlePull}\n\t\t\t\t\t\t\t\tdisabled={isPulling || !currentRepoName}\n\t\t\t\t\t\t\t\tclass=\"flex-1 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white py-2 px-4 rounded text-sm transition-colors\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#if isPulling}\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center space-x-2\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"loading-spinner w-4 h-4\"></div>\n\t\t\t\t\t\t\t\t\t\t<span>Pulling...</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\tPull\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if gitStatus && !gitStatus.clean}\n\t\t\t\t\t\t\t<div class=\"mb-4\">\n\t\t\t\t\t\t\t\t<label for=\"commit-message\" class=\"block text-sm font-medium text-gray-300 mb-2\">\n\t\t\t\t\t\t\t\t\tCommit Message\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tid=\"commit-message\"\n\t\t\t\t\t\t\t\t\tbind:value={commitMessage}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Enter commit message...\"\n\t\t\t\t\t\t\t\t\tclass=\"w-full px-3 py-2 bg-dark-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:border-blue-500 text-sm\"\n\t\t\t\t\t\t\t\t\trows=\"3\"\n\t\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"flex space-x-2 mb-4\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ton:click={handleCommit}\n\t\t\t\t\t\t\t\t\tdisabled={isCommitting || !commitMessage.trim()}\n\t\t\t\t\t\t\t\t\tclass=\"flex-1 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white py-2 px-4 rounded text-sm transition-colors\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if isCommitting}\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center space-x-2\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"loading-spinner w-4 h-4\"></div>\n\t\t\t\t\t\t\t\t\t\t\t<span>Committing...</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\tCommit Changes\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ton:click={handlePush}\n\t\t\t\t\t\t\tdisabled={isPushing || !currentRepoName}\n\t\t\t\t\t\t\tclass=\"w-full bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-white py-2 px-4 rounded text-sm transition-colors\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if isPushing}\n\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-center space-x-2\">\n\t\t\t\t\t\t\t\t\t<div class=\"loading-spinner w-4 h-4\"></div>\n\t\t\t\t\t\t\t\t\t<span>Pushing...</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\tPush to Remote\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Sidebar Resize Handle -->\n\t\t\t\t<button\n\t\t\t\t\trole=\"separator\"\n\t\t\t\t\taria-label=\"Resize file tree panel\"\n\t\t\t\t\tclass=\"absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 bg-transparent transition-colors border-0 p-0\"\n\t\t\t\t\ton:mousedown={(e) => startResize('filetree', e)}\n\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t// Keyboard resize logic can be added here\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t></button>\n\t\t\t</aside>\n\n\t\t\t<!-- Main Content Area (Editor + PDF) -->\n\t\t\t<div class=\"flex-1 flex main-content-area\" style=\"contain: layout style;\">\n\t\t\t\t<!-- Editor -->\n\t\t\t\t{#if layoutMode === 'editor' || layoutMode === 'both'}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex flex-col {layoutMode === 'both' ? '' : 'flex-1'}\"\n\t\t\t\t\t\tstyle={layoutMode === 'both'\n\t\t\t\t\t\t\t? `width: ${editorWidth}%; transform: translateZ(0); will-change: width;`\n\t\t\t\t\t\t\t: 'transform: translateZ(0);'}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if currentFilePath}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"bg-dark-700 px-4 py-2 border-b border-gray-600 text-sm text-gray-300 flex items-center justify-between\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>Editing: {getFileNameFromPath(currentFilePath)}</span>\n\t\t\t\t\t\t\t\t<span class=\"text-xs text-gray-500\">Auto-save enabled</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t<div bind:this={editorContainer} class=\"w-full h-full\"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if compileError}\n\t\t\t\t\t\t\t<div class=\"bg-red-500/10 border-t border-red-500/20 p-4 text-red-300\">\n\t\t\t\t\t\t\t\t<div class=\"flex items-start space-x-2\">\n\t\t\t\t\t\t\t\t\t<svg class=\"w-5 h-5 mt-0.5 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<p class=\"font-medium\">Compilation Error</p>\n\t\t\t\t\t\t\t\t\t\t<p class=\"text-sm text-red-200 mt-1\">{compileError}</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- Resize Handle between Editor and PDF -->\n\t\t\t\t{#if layoutMode === 'both'}\n\t\t\t\t\t<button\n\t\t\t\t\t\trole=\"separator\"\n\t\t\t\t\t\taria-label=\"Resize editor and PDF panels\"\n\t\t\t\t\t\tclass=\"w-1 bg-gray-600 hover:bg-blue-500 cursor-col-resize transition-colors relative border-0 p-0\"\n\t\t\t\t\t\tstyle=\"transform: translateZ(0); will-change: background-color;\"\n\t\t\t\t\t\ton:mousedown={(e) => startResize('editor-pdf', e)}\n\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\tif (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t// Keyboard resize logic can be added here\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t></button>\n\t\t\t\t{/if}\n\n\t\t\t\t<!-- PDF Preview -->\n\t\t\t\t{#if layoutMode === 'pdf' || layoutMode === 'both'}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex flex-col border-l border-gray-700 {layoutMode === 'both' ? '' : 'flex-1'}\"\n\t\t\t\t\t\tstyle={layoutMode === 'both'\n\t\t\t\t\t\t\t? `width: ${100 - editorWidth}%; transform: translateZ(0); will-change: width;`\n\t\t\t\t\t\t\t: 'transform: translateZ(0);'}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"relative\"\n\t\t\t\t\t\t\tstyle=\"flex: {showAiChat ? '1 1 auto' : '1 1 0'}; min-height: {showAiChat\n\t\t\t\t\t\t\t\t? '200px'\n\t\t\t\t\t\t\t\t: '0'};\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<PdfPreview {pdfUrl} isLoading={isCompiling} error={compileError} />\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<!-- AI Chat Panel Resize Handle -->\n\t\t\t\t\t\t{#if showAiChat && (layoutMode === 'pdf' || layoutMode === 'both')}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\trole=\"separator\"\n\t\t\t\t\t\t\t\taria-label=\"Resize AI chat panel\"\n\t\t\t\t\t\t\t\tclass=\"h-1 w-full cursor-row-resize hover:bg-blue-500 bg-gray-600 transition-colors border-0 p-0\"\n\t\t\t\t\t\t\t\ton:mousedown={(e) => startResize('ai-chat', e)}\n\t\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\t\tif (e.key === 'ArrowUp' || e.key === 'ArrowDown') {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t// Keyboard resize logic can be added here\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t></button>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<!-- AI Chat Panel (now in PDF column) -->\n\t\t\t\t\t\t{#if showAiChat && (layoutMode === 'pdf' || layoutMode === 'both')}\n\t\t\t\t\t\t\t<div style=\"height: {aiChatHeight}px; flex-shrink: 0;\">\n\t\t\t\t\t\t\t\t<AiChatPanel\n\t\t\t\t\t\t\t\t\tisVisible={true}\n\t\t\t\t\t\t\t\t\tbind:height={aiChatHeight}\n\t\t\t\t\t\t\t\t\tbind:messages={aiChatMessages}\n\t\t\t\t\t\t\t\t\tisLoading={aiChatLoading}\n\t\t\t\t\t\t\t\t\trepoName={currentRepoName || ''}\n\t\t\t\t\t\t\t\t\tuserId={$authStore.user?.id || 'anonymous'}\n\t\t\t\t\t\t\t\t\ton:heightChange={(e) => (aiChatHeight = e.detail)}\n\t\t\t\t\t\t\t\t\ton:sendMessage={handleAiChatMessage}\n\t\t\t\t\t\t\t\t\ton:clearMessages={handleClearAiChat}\n\t\t\t\t\t\t\t\t\ton:claudeCodeRequired={handleClaudeCodeRequired}\n\t\t\t\t\t\t\t\t\ton:applyEdit={handleApplyEdit}\n\t\t\t\t\t\t\t\t\ton:rejectEdit={handleRejectEdit}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<!-- Claude Code Modal (Full Screen) -->\n<ClaudeCodeModal\n\tbind:isOpen={showClaudeCodeModal}\n\tauthUrl={claudeAuthUrl}\n\tsessionId={claudeSessionId}\n\tisLoading={claudeCodeSubmitting}\n\ton:submit={handleClaudeCodeSubmit}\n\ton:cancel={handleClaudeCodeCancel}\n/>\n"],"names":["API_URL","ApiClient","baseUrl","endpoint","options","url","response","errorData","repoUrl","userId","credentials","repoName","texFile","filePath","params","content","message","author","remote","branch","body","folderPath","oldPath","newPath","onChunk","error","reader","decoder","done","value","chunk","step","verificationCode","sessionId","apiClient","item","$$props","depth","expandedDirs","selectedFile","draggedItem","dragOverItem","isDragging","onToggleDirectory","onSelectFile","onContextMenu","onDragStart","onDragEnd","onDragOver","onDragLeave","onDrop","isValidDropTarget","getFileIcon","formatFileSize","bytes","$$payload","$.attr_style","$.stringify","$.escape","each_array","$.ensure_array_like","child","$$index","onFileSelect","$.fallback","fileTree","loading","contextMenuVisible","contextMenuX","contextMenuY","operationInProgress","loadFileTree","retryCount","err","errorMessage","toggleDirectory","path","selectFile","showContextMenu","e","hideContextMenu","handleDragStart","event","fileName","handleDragEnd","handleDragOver","handleDragLeave","handleDrop","targetPath","draggedName","findItemByPath","items","found","$.attr","pdfUrl","isLoading","getPdfUrlWithPdfJs","isOpen","authUrl","isCompiling","compileError","currentRepoName","fileTreeWidth","editorWidth","gitPanelHeight","showClaudeCodeModal","claudeAuthUrl","claudeSessionId","claudeCodeSubmitting","getCurrentUserId","handleFileSelect","$.attr_class","$$value"],"mappings":"4OAwBA,MAAMA,EAA8E,wBAEpF,MAAMC,CAAU,CACP,QAER,YAAYC,EAAkBF,EAAS,CACtC,KAAK,QAAUE,CAAA,CAGhB,MAAc,QAAWC,EAAkBC,EAAuB,GAAgB,CACjF,MAAMC,EAAM,GAAG,KAAK,OAAO,GAAGF,CAAQ,GAEhCG,EAAW,MAAM,MAAMD,EAAK,CACjC,QAAS,CACR,eAAgB,mBAChB,GAAGD,EAAQ,OACZ,EACA,GAAGA,CAAA,CACH,EAEG,GAAA,CAACE,EAAS,GAAI,CACX,MAAAC,EAAY,MAAMD,EAAS,KAAK,EAAE,MAAM,KAAO,CAAE,MAAO,eAAA,EAAkB,EAChF,MAAM,IAAI,MAAMC,EAAU,OAAS,8BAA8BD,EAAS,MAAM,EAAE,CAAA,CAGnF,OAAOA,EAAS,KAAK,CAAA,CAGtB,MAAM,UAAUE,EAAiBC,EAAS,YAAaC,EAAkF,CACjI,OAAA,KAAK,QAA2B,aAAc,CACpD,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,QAAAF,EAAS,OAAAC,EAAQ,YAAAC,CAAa,CAAA,CAAA,CACrD,CAAA,CAGF,MAAM,YACLC,EACAF,EAAS,YACTG,EAAU,WACqB,CACxB,OAAA,KAAK,QAA6B,eAAgB,CACxD,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAAD,EAAU,OAAAF,EAAQ,QAAAG,CAAS,CAAA,CAAA,CAClD,CAAA,CAGF,MAAM,YAAYD,EAAkBF,EAAS,YAAwC,CACpF,OAAO,KAAK,QAA0B,cAAcA,CAAM,IAAIE,CAAQ,EAAE,CAAA,CAGzE,MAAM,gBAAgBA,EAAkBF,EAAS,YAA+B,CAC3E,GAAA,CACG,aAAA,KAAK,YAAYE,EAAUF,CAAM,EAChC,QACQ,CACR,MAAA,EAAA,CACR,CAGD,MAAM,eACLE,EACAE,EACAJ,EAAS,YACsB,CAC/B,MAAMK,EAAS,IAAI,gBAAgB,CAAE,SAAAD,EAAU,EACxC,OAAA,KAAK,QAA6B,cAAcJ,CAAM,IAAIE,CAAQ,YAAYG,CAAM,EAAE,CAAA,CAG9F,MAAM,SACLH,EACAE,EACAE,EACAN,EAAS,YACmB,CAC5B,OAAO,KAAK,QAA0B,cAAcA,CAAM,IAAIE,CAAQ,WAAY,CACjF,OAAQ,MACR,KAAM,KAAK,UAAU,CAAE,SAAAE,EAAU,QAAAE,CAAS,CAAA,CAAA,CAC1C,CAAA,CAGF,MAAM,aAAaJ,EAAkBF,EAAS,YAAyC,CACtF,OAAO,KAAK,QAA2B,YAAYA,CAAM,IAAIE,CAAQ,SAAS,CAAA,CAG/E,MAAM,cACLA,EACAK,EACAP,EAAS,YACTQ,EAC6B,CAC7B,OAAO,KAAK,QAA2B,YAAYR,CAAM,IAAIE,CAAQ,UAAW,CAC/E,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,QAAAK,EAAS,OAAAC,CAAQ,CAAA,CAAA,CACxC,CAAA,CAGF,MAAM,YACLN,EACAF,EAAS,YACTS,EAAS,SACTC,EAC2B,CACrB,MAAAC,EAA4C,CAAE,OAAAF,CAAO,EAC3D,OAAIC,IACHC,EAAK,OAASD,GAER,KAAK,QAAyB,YAAYV,CAAM,IAAIE,CAAQ,QAAS,CAC3E,OAAQ,OACR,KAAM,KAAK,UAAUS,CAAI,CAAA,CACzB,CAAA,CAGF,MAAM,aACLT,EACAF,EAAS,YACTS,EAAS,SACmB,CAC5B,OAAO,KAAK,QAA0B,YAAYT,CAAM,IAAIE,CAAQ,SAAU,CAC7E,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,OAAAO,CAAQ,CAAA,CAAA,CAC/B,CAAA,CAGF,MAAM,YACLP,EACAF,EAAS,YACTS,EAAS,SACTC,EAC2B,CACrB,MAAAC,EAA4C,CAAE,OAAAF,CAAO,EAC3D,OAAIC,IACHC,EAAK,OAASD,GAER,KAAK,QAAyB,YAAYV,CAAM,IAAIE,CAAQ,QAAS,CAC3E,OAAQ,OACR,KAAM,KAAK,UAAUS,CAAI,CAAA,CACzB,CAAA,CAGF,MAAM,WACLT,EACAE,EACAE,EAAU,GACVN,EAAS,YACqB,CAC9B,OAAO,KAAK,QAA4B,cAAcA,CAAM,IAAIE,CAAQ,eAAgB,CACvF,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAAE,EAAU,QAAAE,CAAS,CAAA,CAAA,CAC1C,CAAA,CAGF,MAAM,aACLJ,EACAU,EACAZ,EAAS,YACuB,CAChC,OAAO,KAAK,QAA8B,cAAcA,CAAM,IAAIE,CAAQ,iBAAkB,CAC3F,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,WAAAU,CAAY,CAAA,CAAA,CACnC,CAAA,CAGF,MAAM,WACLV,EACAE,EACAJ,EAAS,YACqB,CAC9B,OAAO,KAAK,QAA4B,cAAcA,CAAM,IAAIE,CAAQ,UAAW,CAClF,OAAQ,SACR,KAAM,KAAK,UAAU,CAAE,SAAAE,CAAU,CAAA,CAAA,CACjC,CAAA,CAGF,MAAM,WACLF,EACAW,EACAC,EACAd,EAAS,YACqB,CAC9B,OAAO,KAAK,QAA4B,cAAcA,CAAM,IAAIE,CAAQ,UAAW,CAClF,OAAQ,MACR,KAAM,KAAK,UAAU,CAAE,QAAAW,EAAS,QAAAC,CAAS,CAAA,CAAA,CACzC,CAAA,CAGF,MAAM,kBACLZ,EACAK,EACAP,EAAS,YACmB,CACrB,OAAA,KAAK,QAA0B,cAAe,CACpD,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAAE,EAAU,QAAAK,EAAS,OAAAP,CAAQ,CAAA,CAAA,CAClD,CAAA,CAGF,MAAM,2BACLE,EACAK,EACAQ,EACAf,EAAS,YACO,CAChB,MAAMH,EAAW,MAAM,MAAM,GAAG,KAAK,OAAO,cAAe,CAC1D,OAAQ,OACR,QAAS,CACR,eAAgB,kBACjB,EACA,KAAM,KAAK,UAAU,CAAE,SAAAK,EAAU,QAAAK,EAAS,OAAAP,CAAQ,CAAA,CAAA,CAClD,EAEG,GAAA,CAACH,EAAS,GAAI,CACX,MAAAmB,EAAQ,MAAMnB,EAAS,KAAK,EAClC,MAAM,IAAI,MAAMmB,EAAM,OAAS,wBAAwB,CAAA,CAGpD,GAAA,CAACnB,EAAS,KACP,MAAA,IAAI,MAAM,kBAAkB,EAG7B,MAAAoB,EAASpB,EAAS,KAAK,UAAU,EACjCqB,EAAU,IAAI,YAEhB,GAAA,CACH,OAAa,CACZ,KAAM,CAAE,KAAAC,EAAM,MAAAC,CAAU,EAAA,MAAMH,EAAO,KAAK,EAE1C,GAAIE,EACH,MAGD,MAAME,EAAQH,EAAQ,OAAOE,EAAO,CAAE,OAAQ,GAAM,EACpDL,EAAQM,CAAK,CAAA,CACd,QACC,CACDJ,EAAO,YAAY,CAAA,CACpB,CAGD,MAAM,4BACLf,EACAF,EAAS,YACTsB,EAAO,QAWL,CACK,OAAA,KAAK,QAAQ,gCAAiC,CACpD,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAApB,EAAU,OAAAF,EAAQ,KAAAsB,CAAM,CAAA,CAAA,CAC/C,CAAA,CAGF,MAAM,iBACLpB,EACAqB,EACAC,EACAxB,EAAS,YAMP,CACK,OAAA,KAAK,QAAQ,0BAA2B,CAC9C,OAAQ,OACR,KAAM,KAAK,UAAU,CAAE,SAAAE,EAAU,iBAAAqB,EAAkB,UAAAC,EAAW,OAAAxB,CAAQ,CAAA,CAAA,CACtE,CAAA,CAGF,MAAM,mBACLE,EACAF,EAAS,YAIP,CACF,OAAO,KAAK,QAAQ,uBAAuBA,CAAM,IAAIE,CAAQ,GAAI,CAChE,OAAQ,QAAA,CACR,CAAA,CAGF,MAAM,oBACLA,EACAF,EAC0F,CAC1F,OAAO,KAAK,QAAQ,mBAAmBA,CAAM,IAAIE,CAAQ,UAAW,CACnE,OAAQ,MAAA,CACR,CAAA,CAEH,CAEa,MAAAuB,EAAY,IAAIjC,0BC/TjBkC,EAAkBC,EAAA,KAClBC,YAAgB,CAAC,EACjBC,EAAyBF,EAAA,aACzBG,EAA2BH,EAAA,aAC3BI,EAA0BJ,EAAA,YAC1BK,EAA2BL,EAAA,aAC3BM,EAAmBN,EAAA,WACnBO,EAAyCP,EAAA,kBACzCQ,EAAoCR,EAAA,aACpCS,EAAwDT,EAAA,cACxDU,EAAsDV,EAAA,YACtDW,EAAqBX,EAAA,UACrBY,EAAkCZ,EAAA,WAClCa,EAAmCb,EAAA,YACnCc,EAA8Bd,EAAA,OAC9Be,EAA4Cf,EAAA,2BAE9CgB,EAAYjB,EAA4B,CAC5C,GAAAA,EAAK,OAAS,mBACVG,EAAa,IAAIH,EAAK,IAAI,EAAI,KAAO,YAGjCA,EAAK,KAAK,MAAM,GAAG,EAAE,IAAG,GAAI,YAAW,EACxC,KACL,YACG,SACH,YACG,SACH,UACA,UACA,WACA,YACG,UACH,WACG,SACH,aACG,SACH,YACG,mBAEA,KAEV,UAESkB,EAAeC,EAAuB,QAC1CA,EAAQ,KAAI,GAAYA,CAAK,KAC7BA,EAAQ,KAAO,KAAI,IAAaA,EAAQ,MAAM,QAAQ,CAAC,CAAA,MAChD,IAAAA,GAAS,KAAO,OAAO,QAAQ,CAAC,CAAA,KAC5C,IAG6CC,EAAA,KAAA,2BAAAC,EAAA,gBAAAC,EAAApB,EAAQ,EAAE,CAAA,IAAA,CAAA,IAClDF,EAAK,OAAS,YAAW,uMAoBVK,IAAgBL,EAAK,mBACpBM,IAAiBN,EAAK,MAAQO,GAAcS,EAAkBhB,EAAK,IAAI,kBACrEM,IAAiBN,EAAK,MAAQO,GAAcS,EAAkBhB,EAAK,IAAI,eAC1EM,IAAiBN,EAAK,MAAQO,GAAcS,EAAkBhB,EAAK,IAAI,oBAClEM,IAAiBN,EAAK,MAC5CO,GACAS,EAAkBhB,EAAK,IAAI,CAED,CAAA,CAAA,8BAAAuB,EAAAN,EAAYjB,CAAI,CACd,CAAA,uCAAAuB,EAAAvB,EAAK,IAAI,CAAA,oBAElCG,EAAa,IAAIH,EAAK,IAAI,GAAKA,EAAK,SAAQ,mBACzC,MAAAwB,EAAAC,EAAAzB,EAAK,QAAQ,wDAAI0B,EAAKF,EAAAG,CAAA,YAErBD,EACC,MAAAxB,EAAQ,gfA0BEE,IAAiBJ,EAAK,kBACvBI,IAAiBJ,EAAK,qBACnBI,IAAiBJ,EAAK,kBACzBK,IAAgBL,EAAK,IAGX,CAAA,CAAA,qEAAAuB,EAAAN,EAAYjB,CAAI,CACd,CAAA,uCAAAuB,EAAAvB,EAAK,IAAI,CAAA,iBAElCA,EAAK,OAAS,uHAEhBkB,EAAelB,EAAK,IAAI,CAAA,CAAA,4UCzHlB,IAAAxB,eAA0B,IAAI,EAC9BF,aAAiB,WAAW,EAC5BsD,EAAwCC,EAAA5B,EAAA,aAAA,IAAS,CAAA,CAAE,EAE1D6B,EAAwB,CAAA,EACxB3B,MAAmB,IACnBC,EAA8B,KAC9B2B,EAAU,GACVzC,EAAuB,KAWvB0C,EAAqB,GACrBC,EAAe,EACfC,EAAe,EACfC,EAAsB,GAGtB9B,EAA6B,KAC7BC,EAA8B,KAC9BC,EAAa,GAYF,eAAA6B,EAAaC,EAAa,EAAG,IACtC7D,EAEL,CAAAuD,EAAU,GACVzC,EAAQ,KAEJ,GAAA,CAEHwC,SADuB/B,EAAU,YAAYvB,EAAUF,CAAM,GACzC,KACpB,QAAQ,IAAI,iCAAkCwD,EAAS,OAAQ,OAAO,CACtE,OAAQQ,EAAK,OACPC,EAAeD,aAAe,MAAQA,EAAI,QAAU,2BAC1D,QAAQ,MAAM,2BAA4BC,CAAY,GAGjDA,EAAa,SAAS,oCAAoC,GAC7DA,EAAa,SAAS,sBAAsB,GAC5CA,EAAa,SAAS,WAAW,IAAMF,EAAa,GACrD,QAAQ,IAAyC,qCAAA,EAAIA,CAAU,wBAAwBA,EAAa,CAAC,KAAA,EACrG/C,EAAK,4CAA+C+C,EAAa,CAAC,MAGlE,WAAiB,IAAA,CAChBD,EAAaC,EAAa,CAAC,CAC3B,GAAG,EAAIA,GAAc,MACZE,EAAa,SAAS,oCAAoC,GAChEA,EAAa,SAAS,sBAAsB,GAC5CA,EAAa,SAAS,WAAW,EACrCjD,EAAQ,sGAERA,EAAQiD,CAEV,QAAU,EACLF,IAAe,GAAKA,GAAc,KACrCN,EAAU,GAEZ,EACD,UAESS,EAAgBC,EAAc,CAClCtC,EAAa,IAAIsC,CAAI,EACxBtC,EAAa,OAAOsC,CAAI,EAExBtC,EAAa,IAAIsC,CAAI,EAEtBtC,EAAY,IAAO,IAAIA,CAAY,CACpC,UAESuC,EAAWhE,EAAkB,CACrC0B,EAAe1B,EACfkD,EAAalD,CAAQ,CACtB,CAES,SAAAiE,EAAgBC,EAAeH,EAAc,CACrDG,EAAE,eAAc,EAEhBX,EAAeW,EAAE,QACjBV,EAAeU,EAAE,QACjBZ,EAAqB,EACtB,CAES,SAAAa,GAAkB,CAC1Bb,EAAqB,EAEtB,CAiHS,SAAAc,EAAgBL,EAAcM,EAAmB,IACzD1C,EAAcoC,EACdlC,EAAa,GACbsC,EAAe,EAGf,SAAS,KAAK,UAAU,IAAI,UAAU,EAGlCE,GAAO,aAAc,CACxBA,EAAM,aAAa,cAAgB,aAC7BC,EAAWP,EAAK,MAAM,GAAG,EAAE,IAAG,GAAMA,EAC1CM,EAAM,aAAa,QAAQ,aAAcC,CAAQ,CAClD,CACD,CAES,SAAAC,GAAgB,CACxB5C,EAAc,KACdC,EAAe,KACfC,EAAa,GAGb,SAAS,KAAK,UAAU,OAAO,UAAU,CAC1C,UAES2C,EAAeT,EAAc,CACjCpC,GAAeA,IAAgBoC,IAClCnC,EAAemC,EAEjB,UAESU,EAAgBV,EAAc,CAClCnC,IAAiBmC,IACpBnC,EAAe,KAEjB,gBAEe8C,EAAWC,EAAoB,CACxC,GAAA,CAAAhD,IAAgB7B,GAAY6B,IAAgBgD,EAAY,CAC5DhD,EAAc,KACdC,EAAe,KACfC,EAAa,SAEd,CAGI,GAAA8C,EAAW,WAAWhD,EAAc,GAAG,EAAG,CAC7CA,EAAc,KACdC,EAAe,KACfC,EAAa,SAEd,CAEA4B,EAAsB,GAClB,GAAA,OACGmB,EAAcjD,EAAY,MAAM,GAAG,EAAE,IAAG,GAAM,GAC9CjB,EAAUiE,EAAU,GAAMA,CAAU,IAAIC,CAAW,GAAKA,KAG1DjD,IAAgBjB,eAIdW,EAAU,WAAWvB,EAAU6B,EAAajB,EAASd,CAAM,QAC3D8D,EAAY,EAGdhC,IAAiBC,IACpBD,EAAehB,EACfwC,EAAaxC,CAAO,EAErB,OAAQkD,EAAK,CACbhD,EAAQgD,aAAe,MAAQA,EAAI,QAAU,qBAC9C,QAAU,CACTH,EAAsB,GACtB9B,EAAc,KACdC,EAAe,KACfC,EAAa,EACd,CACD,CAGS,SAAAgD,EAAeC,EAAuBf,EAAmC,WACtEzC,KAAQwD,EAAO,CACrB,GAAAxD,EAAK,OAASyC,SACVzC,KAEJA,EAAK,SAAU,CACZ,MAAAyD,EAAQF,EAAevD,EAAK,SAAUyC,CAAI,EAC5C,GAAAgB,SAAcA,CACnB,CACD,QACO,IACR,UAGSzC,EAAkBqC,EAA6B,CAClD,OAAAA,EACcE,EAAezB,EAAUuB,CAAU,GACnC,OAAS,YAFJ,EAGzB,IAzRO7E,GACN4D,EAAY,gQAqSL5D,gFAC4CA,CAAQ,CAAA,oDAGrDA,qBAOQ4C,EAAA,KAAA,8KAAAsC,EAAA,WAAA3B,GAAWI,EAgBX,EAAA,CAAA,iaAAAuB,EAAA,WAAAvB,sWAgBAA,EAAmB,EAAA,CAAA,sZAgCd7B,IAAiB,IAAMC,kBACrBD,IAAiB,IAAMC,aAC5BD,IAAiB,IAAMC,oBAChBD,IAAiB,IAAMC,kBACzBD,IAAiB,IAAMC,UAC7BD,IAAiB,IAAMC,QAC3BD,IAAiB,IAAMC,OAE7BD,IAAiB,IAAMC,yKAMvBwB,+KAKKzC,+JAG0BA,CAAK,CAAA,8GAQ9Bd,kJAKDsD,EAAS,SAAW,2KAMtBA,CAAQ,wDAAI9B,EAAIwB,EAAAG,CAAA,oBAGd,4FAMYa,eACLE,gBACCC,cACFG,YACFG,aACCC,cACCC,SACLC,mEAQPpB,qBAGWZ,EAAA,KAAA,iGAAAC,EAAA,SAAAC,EAAAW,CAAY,eAAWC,CAAY,CAAA,KAAA,CAAA,0vBC7dxC,IAAAyB,aAAwB,IAAI,EAC5BC,gBAAY,EAAK,EACjBtE,YAAuB,IAAI,WAsB7BuE,EAAmB9F,EAAyB,CAEd,MAAA,+BAAA,mBAAmBA,CAAO,CAAA,EACjE,+IAaM6F,qPAOKtE,glBAiB+BA,CAAK,CAAA,0HAMnCqE,sBA8CJvC,EAAA,KAAA,UAAAsC,EAAA,MAAAG,EAAmBF,CAAM,CAAA,CAAA,8sBAU5BA,GAAM,CAAKC,GAAS,CAAKtE,qBAsBpB8B,EAAA,KAAA,4kBAAAsC,EAAA,OAAAG,EAAmBF,CAAM,CAAA,CAAA,ugBClJvB,IAAAG,aAAS,EAAK,EACdC,cAAU,EAAE,EACZjE,gBAAY,EAAE,EACd8D,gBAAY,EAAK,EAIxB/D,EAAmB,GA8CpBiE,qBAoBa1C,EAAA,KAAA,2UAAAsC,EAAA,WAAAE,EAgCI,EAAA,CAAA,0rCAAAF,EAAA,WAAAE,EAkBE,EAAA,CAAA,geAAAF,EAAA,QAAA7D,CAAgB,yEAElB+D,EAAS,EAAA,CAAA,6QA2BXxC,EAAA,KAAA,ofAAAsC,EAAA,WAAAE,EAOA,EAAA,CAAA,oMAAAF,EAAA,WAAAE,GAAc,CAAA/D,EAAiB,OAAI,EAAA,CAAA,+PAGxC+D,4zBC5FV,IAAAI,EAAc,GACdC,EAA8B,KAE9BC,EAAiC,KAIjCP,EAAwB,KAIxBQ,EAAgB,IAChBC,EAAc,GAGdC,EAAiB,GAkBjBC,EAAsB,GACtBC,EAAgB,GAChBC,EAAkB,GAClBC,EAAuB,GA6BlB,SAAAC,GAA2B,iCACjB,MAAM,IAAM,WAC/B,gBAyHeC,EAAiBjG,EAAkB,CAgClD,01BA01BO,kDAAkD,CAAA,EAAA,CAAA,+CAAAkG,EAAA,iDAAAtD,EAQlD,wBACkD,CAOC,EAAA,CAAA,8CAAAsD,EAAA,iDAAAtD,EAEnD,kDAAkD,CAUe,EAAA,CAAA,+CAAAsD,EAAA,gEAAAtD,EAElE,EAAE,CAAA,EAAA,CAAA,geAyDKF,EAAA,KAAA,mBAAAsC,EAAA,YAAgBQ,EAAe,EAAA,CAAA,yVAqB1BC,CAAa,CAAA,KAAA,CAAA,yDAAA9C,EAAA,WAAAC,EAKX,IAAM+C,CAAc,CAAA,IAAA,CAAA,kBAGzBH,SACFQ,EAAgB,eACVC,0OAmB6BN,CAAc,CAAA,IAAA,CAAA,mvBAyH7CjD,EAAA,KAAA,oDAAAsC,EAAA,YAAeQ,EAAe,EAAA,CAAA,8LAc9B9C,EAAA,KAAA,4BAAAsC,EAAA,YAAcQ,EAAe,EAAA,CAAA,kPAgD9B9C,EAAA,KAAA,mBAAAsC,EAAA,YAAcQ,EAAe,EAAA,CAAA,ohBAmClB9C,EAAA,KAAA,OAAAwD,EAAA,iBAAAtD,EAAwB,EAAa,CACpD,EAAA,CAAA,GAAAD,EACM,UAAA+C,CAAW,kDACM,CAAA,khBAwDyC,EAAa,CAAA,EAAA,CAAA,GAAA/C,EACzD,UACd,IAAM+C,CAAW,kDACA,CAIf,yBAAA/C,EAAA,SAAAC,EAA0B,OAAO,CAAgB,iBAAAA,EAE5D,GAAG,CAAA,GAAA,CAAA,6BAE0B0C,QAAoBC,sKAgDjDM,YACEC,YACAC,sBAHEH,iBAAAA,EAAmBO"}